<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/web-exploitation/prtg-network-monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/web-exploitation/prtg-network-monitor"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/now/">now</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>PRTG network monitor</h1>

<p>agentless network monitor software. get statistics from various hosts: routers, switches, etc. works in autodiscovery mode to build a list of devices, and gather info from them with ICMP, SNMP, WMI, NetFlow, etc.</p>

<p>a REST API is available to communicate with the software. currently suffers from 26 CVEs. rarely exposed externally, but often encountered in internal pentests.</p>

<h2>discovery - enumeration</h2>

<p>PRTG usually lives on ports 80, 443, or 8080. a nmap scan with <code>-sV</code> can quickly find it. default credentials are <code>prtgadmin:prtgadmin</code> and are often left unchanged. version can be easily obtained with curl:</p>

<div class="highlight"><pre class="highlight shell"><code>curl <span class="nt">-s</span> http://&lt;IP&gt;:&lt;port&gt;/index.htm | <span class="nb">grep </span>version
</code></pre></div>

<h2>attack paths</h2>

<h3>remote code execution</h3>

<p>versions lower than 18.2.39 might be vulnerable to authenticated command injection as shown in <code>CVE-2018-9276</code>: the parameter field is directly parsed into a powershell script when it creates a new notification, with no input sanitization being made.</p>

<p>go to <code>setup -&gt; account settings -&gt; notifications</code> and click on <code>add new notification</code> (little <code>+</code> button on the right). in creation menu, give our notification a name and tick the <code>execute program</code> checkbox.</p>

<p>select <code>demo exe notification - outfile.ps1</code> as the <code>program file</code> and under <code>parameter field</code> add the command with the <code>test.txt;&lt;payload here&gt;</code> injection, such as:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">test.txt</span><span class="p">;</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">hacky</span><span class="w"> </span><span class="nx">Hackh4ck</span><span class="o">!</span><span class="w"> </span><span class="nx">/add</span><span class="p">;</span><span class="n">net</span><span class="w"> </span><span class="nx">localgroup</span><span class="w"> </span><span class="nx">administrators</span><span class="w"> </span><span class="nx">hacky</span><span class="w"> </span><span class="nx">/add</span><span class="w">
</span></code></pre></div>

<p>click <code>save</code>, and click <code>test</code> after getting redirected. the command will be executed blindly so checking if everything worked as intended depends on our payload. for our previous one, we could try to authenticate through SMB and see if our user has been created and added in the <code>administrators</code> group:</p>

<div class="highlight"><pre class="highlight shell"><code>crackmapexec smb &lt;target IP&gt; <span class="nt">-u</span> hacky <span class="nt">-p</span> Hackh4ck!
</code></pre></div>

<p>we&#39;ve only hit <code>test</code> for immediate execution, but our payload could be run on a schedule to establish some form of persistence. go to the <code>account settings</code> menu to create / edit a schedule.</p>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

