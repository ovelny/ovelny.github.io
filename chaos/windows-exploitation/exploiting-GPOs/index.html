<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - chaos/windows-exploitation/exploiting-GPOs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - notes on infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
    <script src="/assets/js/scramble-text.min.js" defer></script>
    <script src="/assets/js/zoom-images.min.js" defer></script>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ovelny"/>
    <meta name="twitter:title" content="ovelny - chaos/windows-exploitation/exploiting-GPOs"/>
    <meta name="twitter:image" content="https://ovelny.sh/assets/images/ovelny-logo.png"/>
    <meta name="twitter:image:alt" content="ovelny logo: 6 white circles grouped together forming a triangle shape, with a black background."/>
  </head>
  <body>

    <header>
      <section>
        <a href="/">
          <img
            class="logo"
            src="/assets/images/ovelny-pfp.png"
            alt="ovelny profile picture: a glitched picture of a three-eyed girl, staring intensely at the viewer."
          />
        </a>
        <h2><a class="ovelny" href="/">ovelny</a></h2>
      </section>
      <nav>
        <a href="/">home</a>
        <a href="/chaos/">chaos</a>
        <a href="/phasm/">phasm</a>
        <a href="/support/">support</a>
        <a href="/atom.xml" target="_blank" rel="noopener noreferrer">rss</a>
        <a href="/about/">about</a>
      </nav>
    </header>
    <main>

    
    <h1>exploiting GPOs</h1>

<div class="highlight"><pre class="highlight powershell"><code><span class="c"># to exploit group policy objects, we need to launch mmc with</span><span class="w">
</span><span class="c"># an AD user that has the appropriate permissions</span><span class="w">
</span><span class="n">runas</span><span class="w"> </span><span class="nx">/netonly</span><span class="w"> </span><span class="nx">/user:</span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="nx">\</span><span class="err">&lt;</span><span class="nx">AD_username</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cmd.exe</span><span class="w">

</span><span class="c"># check that provided credentials worked</span><span class="w">
</span><span class="n">dir</span><span class="w"> </span><span class="nx">\\</span><span class="err">&lt;</span><span class="nx">domain_name</span><span class="err">&gt;</span><span class="nx">\sysvol</span><span class="w">

</span><span class="c"># then launch the microsoft management console</span><span class="w">
</span><span class="n">mmc</span><span class="w">
</span></code></pre></div>

<p>then as an example, to add an AD account to the local administrators and local remote desktop users groups, we need to first enable the group policy management snap-in:</p>

<ul>
<li>click <strong>file -&gt; add/remove snap-in</strong></li>
<li>select the <strong>group policy management</strong> snap-in and click <strong>add</strong></li>
<li>click <strong>ok</strong></li>
</ul>

<p>you should now be able to see GPOs for the domain:</p>

<p><img src="https://ovelny.sh/assets/images/windows-snippets-and-commands/win_gpo_01.jpg" alt="screenshot of MMC (microsoft management console), showing our domains under group policy management -&gt; forest: our top domain -&gt; domains -&gt; our domain. several tabs are shown for the domain on the right panel: status, linked grouped policy objects, group policy inheritance, delegation"></p>

<p>navigate to the GPO that your user can modify:</p>

<p><img src="https://ovelny.sh/assets/images/windows-snippets-and-commands/win_gpo_02.jpg" alt="same screenshot as earlier, but this time under group policy management -&gt; forest: our top domain -&gt; domains -&gt; our domain -&gt; servers -&gt; management servers. the right panel show three tabs for this section: linked group policy objects, group policy inheritance, and delegation. in the first tab, we select the GPO &quot;management server pushes&quot;"></p>

<p>right-click the GPO and select <strong>edit</strong> to open the group policy management editor window:</p>

<p><img src="https://ovelny.sh/assets/images/windows-snippets-and-commands/win_gpo_03.jpg" alt="screenshot of the group policy management editor window, with a left and right panel much like the microsoft management console"></p>

<p>in order to add our account to the local groups, we need to perform the following steps:</p>

<ul>
<li>expand <strong>computer configuration</strong></li>
<li>expand <strong>policies</strong></li>
<li>expand <strong>windows settings</strong></li>
<li>expand <strong>security settings</strong></li>
<li>right click on <strong>restricted groups</strong> and select <strong>add group</strong></li>
<li>click <strong>browse</strong>, enter <strong>IT support</strong> and click <strong>check names</strong></li>
<li>click <strong>okay</strong> twice</li>
</ul>

<p><img src="https://ovelny.sh/assets/images/windows-snippets-and-commands/win_gpo_04.jpg" alt="ZA\IT support properties window. there are two filters to configure membership here: &quot;members of this group&quot;, and &quot;this group is a member of&quot;"></p>

<p>the first filter is not used. for the second filter, we want to add both the administrators and remote desktop users groups. in the end, it should look something like this:</p>

<p><img src="https://ovelny.sh/assets/images/windows-snippets-and-commands/win_gpo_05.jpg" alt="ZA\IT support properties window showing that we added administrators and remote desktop user groups to the &quot;this group is a member of&quot; filter."></p>

<p>once the configuration has been made, we can click <strong>apply</strong> and <strong>ok</strong>. now, all we need to do is wait for a maximum of 15 minutes for the GPO to be applied.</p>

<h2>references</h2>

<ul>
<li><a href="https://tryhackme.com/room/exploitingad" rel="nofollow">https://tryhackme.com/room/exploitingad</a></li>
</ul>

    
    </main>
    <footer id="footer">
      <div class="footer-section"><a href="/license/">CC BY-NC-SA 4.0</a><p>&nbsp;::&nbsp;2019 - 2025 ovelny</p></div>
      <div class="footer-section">「七転び八起き」</div>
    </footer>
  </body>
</html>

